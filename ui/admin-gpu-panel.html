<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ona Energy Management - GPU Asset Management</title>
    <link rel="icon" type="image/x-icon" href="includes/favicon.ico">
    <link rel="stylesheet" href="includes/common.css">
    <link rel="stylesheet" href="includes/dashboard.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* GPU Panel Specific Styles */
        .gpu-panel-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .gpu-nav {
            width: 280px;
            background-color: var(--primary-black);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-section {
            margin-bottom: 30px;
        }

        .nav-section-title {
            color: var(--white);
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 15px;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-button {
            background-color: #2b2b2b;
            color: var(--white);
            border: 1px solid #444;
            padding: 15px;
            text-align: left;
            font-family: 'DM Sans', sans-serif;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            min-width: 0;
        }

        .nav-button:hover {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .nav-button.active {
            background-color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .nav-icon {
            font-size: 18px;
        }

        .gpu-main-content {
            flex-grow: 1;
            padding: 40px;
            background-color: var(--white);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
        }

        /* GPU Cards */
        .gpu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .gpu-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .gpu-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .gpu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .gpu-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .gpu-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        .status-idle {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .status-maintenance {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .gpu-metrics {
            margin-bottom: 20px;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .metric-label {
            color: var(--text-light);
        }

        .metric-value {
            color: var(--text-dark);
            font-weight: 500;
        }

        .gpu-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }

        .action-btn.primary {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .action-btn.secondary {
            background-color: var(--neutral-grey);
            color: var(--text-dark);
        }

        .action-btn.danger {
            background-color: var(--status-red);
            color: var(--white);
        }

        /* Metrics Overview */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .metric-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-blue);
            display: block;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .metric-change {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .metric-change.positive {
            color: var(--status-green);
        }

        .metric-change.negative {
            color: var(--status-red);
        }

        /* Performance Charts */
        .chart-container {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 4px;
            background: var(--white);
            color: var(--text-dark);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-btn:hover {
            background: var(--neutral-light);
        }

        .chart-btn.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .chart-canvas {
            width: 100%;
            height: 300px;
            background: #f8f9fa;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            padding: 10px;
        }

        .chart-canvas canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .chart-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-light);
            font-size: 1.1rem;
        }

        /* Performance Metrics */
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .performance-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .performance-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .performance-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .performance-trend {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .trend-up {
            color: var(--status-green);
        }

        .trend-down {
            color: var(--status-red);
        }

        .trend-stable {
            color: var(--text-light);
        }

        /* Alert System */
        .alerts-section {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-grey);
        }

        .alert-item:last-child {
            border-bottom: none;
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .alert-icon.critical {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .alert-icon.warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .alert-icon.info {
            background-color: rgba(69, 91, 241, 0.1);
            color: var(--primary-blue);
        }

        .alert-content {
            flex-grow: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .alert-time {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .alert-actions {
            display: flex;
            gap: 10px;
        }

        .alert-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alert-btn.acknowledge {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .alert-btn.resolve {
            background-color: var(--status-green);
            color: var(--white);
        }

        /* Maintenance Tools */
        .maintenance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .maintenance-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .maintenance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .maintenance-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .maintenance-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-scheduled {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .status-completed {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        .status-failed {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .maintenance-details {
            margin-bottom: 20px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .detail-label {
            color: var(--text-light);
        }

        .detail-value {
            color: var(--text-dark);
            font-weight: 500;
        }

        .maintenance-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .maintenance-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
        }

        .maintenance-btn.primary {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .maintenance-btn.secondary {
            background-color: var(--neutral-grey);
            color: var(--text-dark);
        }

        .maintenance-btn.danger {
            background-color: var(--status-red);
            color: var(--white);
        }

        /* Driver Management */
        .driver-section {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .driver-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .driver-card {
            background: var(--neutral-light);
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            padding: 20px;
        }

        .driver-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .driver-version {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .driver-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .driver-actions {
            display: flex;
            gap: 10px;
        }

        .driver-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .driver-btn.update {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .driver-btn.rollback {
            background-color: var(--status-yellow);
            color: var(--white);
        }

        /* System Configuration */
        .config-section {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .config-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .config-group {
            margin-bottom: 20px;
        }

        .config-group label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .config-group input,
        .config-group select,
        .config-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-grey);
            border-radius: 6px;
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .config-group input:focus,
        .config-group select:focus,
        .config-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(69, 91, 241, 0.1);
        }

        .config-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .config-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .config-btn.primary {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .config-btn.secondary {
            background-color: var(--neutral-grey);
            color: var(--text-dark);
        }

        .config-btn:hover {
            transform: translateY(-1px);
        }

        /* Enhanced Inventory Cards */
        .inventory-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .inventory-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .inventory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inventory-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .inventory-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .inventory-specs {
            margin-bottom: 20px;
        }

        .spec-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .spec-label {
            color: var(--text-light);
        }

        .spec-value {
            color: var(--text-dark);
            font-weight: 500;
        }

        .inventory-maintenance {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--neutral-light);
            border-radius: 8px;
        }

        .maintenance-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .maintenance-label {
            color: var(--text-light);
        }

        .maintenance-value {
            color: var(--text-dark);
            font-weight: 500;
        }

        .maintenance-overdue {
            color: var(--status-red);
            font-weight: 600;
        }

        .maintenance-due-soon {
            color: var(--status-yellow);
            font-weight: 600;
        }

        .maintenance-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .maintenance-action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
        }

        .maintenance-action-btn.driver {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .maintenance-action-btn.firmware {
            background-color: var(--accent-purple);
            color: var(--white);
        }

        .maintenance-action-btn.inspection {
            background-color: var(--status-green);
            color: var(--white);
        }

        .maintenance-action-btn.repair {
            background-color: var(--status-yellow);
            color: var(--white);
        }

        .maintenance-action-btn.replace {
            background-color: var(--status-red);
            color: var(--white);
        }

        .maintenance-action-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        /* Maintenance Task Creation Modal */
        .maintenance-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .maintenance-modal-content {
            background-color: var(--white);
            margin: auto;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: fadeIn 0.3s ease-out;
        }
        
        .site-details-content {
            padding: 20px;
        }
        
        .site-details-section {
            margin-bottom: 24px;
        }
        
        .site-details-section h4 {
            color: var(--text-dark);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-grey);
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .detail-item.full-width {
            grid-column: 1 / -1;
        }
        
        .detail-label {
            font-weight: 500;
            color: var(--text-medium);
            font-size: 0.9rem;
        }
        
        .detail-value {
            color: var(--text-dark);
            font-weight: 600;
            font-size: 1rem;
            padding: 8px 12px;
            background: var(--background-light);
            border-radius: 6px;
            border: 1px solid var(--border-grey);
        }
        
        /* Component-specific styles */
        .components-container {
            margin-top: 12px;
        }
        
        .component-item {
            background: var(--background-light);
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .component-info h5 {
            margin: 0 0 4px 0;
            color: var(--text-dark);
            font-size: 1rem;
            font-weight: 600;
        }
        
        .component-sku {
            color: var(--text-medium);
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .component-actions {
            display: flex;
            gap: 8px;
        }
        
        .component-action-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 4px;
            background: white;
            color: var(--text-medium);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .component-action-btn:hover {
            background: var(--background-light);
            color: var(--text-dark);
        }
        
        .component-action-btn.delete {
            color: var(--error-color);
            border-color: var(--error-color);
        }
        
        .component-action-btn.delete:hover {
            background: var(--error-color);
            color: white;
        }
        
        .component-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .component-detail {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .component-detail .detail-label {
            font-size: 0.8rem;
            color: var(--text-medium);
        }
        
        .component-detail .detail-value {
            font-size: 0.9rem;
            padding: 4px 8px;
            background: white;
            border: 1px solid var(--border-light);
        }
        
        .add-component-section {
            margin-top: 16px;
            text-align: center;
            padding: 16px;
            border: 2px dashed var(--border-grey);
            border-radius: 8px;
            background: var(--background-light);
        }
        
        .add-component-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .add-component-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .no-components {
            text-align: center;
            color: var(--text-medium);
            font-style: italic;
            padding: 20px;
        }

        .maintenance-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .maintenance-modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .maintenance-modal-close {
            color: var(--text-dark);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
        }

        .maintenance-modal-close:hover {
            color: var(--status-red);
        }

        .maintenance-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .maintenance-form-group {
            margin-bottom: 15px;
        }

        .maintenance-form-group.full-width {
            grid-column: 1 / -1;
        }

        .maintenance-form-group label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 6px;
            font-size: 0.9rem;
        }

        .maintenance-form-group input,
        .maintenance-form-group select,
        .maintenance-form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 6px;
            font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .maintenance-form-group input:focus,
        .maintenance-form-group select:focus,
        .maintenance-form-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(69, 91, 241, 0.1);
        }

        .maintenance-form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .maintenance-modal-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        .maintenance-modal-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-family: 'DM Sans', sans-serif;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .maintenance-modal-btn.primary {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .maintenance-modal-btn.secondary {
            background-color: var(--neutral-grey);
            color: var(--text-dark);
        }

        .maintenance-modal-btn:hover {
            transform: translateY(-1px);
        }

        /* Resource Allocation Styles */
        .job-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--white);
            transition: all 0.3s ease;
        }

        .job-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .job-priority {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .priority-high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .priority-medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .priority-low {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        .job-info {
            flex-grow: 1;
        }

        .job-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .job-details {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            gap: 20px;
        }

        .job-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 15px;
        }

        .status-running {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        .status-queued {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .status-completed {
            background-color: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }

        .job-actions {
            display: flex;
            gap: 8px;
            margin-left: 15px;
        }

        .job-action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .job-action-btn.start {
            background-color: var(--status-green);
            color: var(--white);
        }

        .job-action-btn.stop {
            background-color: var(--status-red);
            color: var(--white);
        }

        .job-action-btn.pause {
            background-color: var(--status-yellow);
            color: var(--white);
        }

        .job-action-btn.delete {
            background-color: #6b7280;
            color: var(--white);
        }

        .job-action-btn:hover {
            opacity: 0.9;
        }

        /* GPU Allocation Status */
        .site-allocation {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--white);
        }

        .site-info {
            flex-grow: 1;
        }

        .site-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .site-gpus {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .gpu-allocation-bar {
            width: 200px;
            height: 20px;
            background-color: var(--neutral-light);
            border-radius: 10px;
            overflow: hidden;
            margin-left: 20px;
            position: relative;
        }

        .gpu-allocation-segment {
            height: 100%;
            float: left;
        }

        .gpu-segment-active {
            background-color: var(--status-green);
        }

        .gpu-segment-idle {
            background-color: var(--status-yellow);
        }

        .gpu-segment-maintenance {
            background-color: var(--status-red);
        }

        .allocation-label {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-left: 10px;
            min-width: 80px;
        }

        /* Capacity Management Styles */
        .capacity-site {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            margin-bottom: 15px;
            background: var(--white);
        }

        .site-capacity-info {
            flex-grow: 1;
        }

        .site-capacity-name {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .site-capacity-details {
            font-size: 0.9rem;
            color: var(--text-light);
            display: flex;
            gap: 20px;
        }

        .capacity-bar-container {
            width: 300px;
            margin-left: 20px;
        }

        .capacity-bar {
            width: 100%;
            height: 24px;
            background-color: var(--neutral-light);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 8px;
        }

        .capacity-segment {
            height: 100%;
            float: left;
        }

        .capacity-ondemand {
            background-color: var(--primary-blue);
        }

        .capacity-spot {
            background-color: var(--status-yellow);
        }

        .capacity-idle {
            background-color: var(--status-green);
        }

        .capacity-maintenance {
            background-color: var(--status-red);
        }

        .capacity-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Preemption Management */
        .preemption-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--white);
        }

        .preemption-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .preemption-warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .preemption-critical {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .preemption-info {
            background-color: rgba(69, 91, 241, 0.1);
            color: var(--primary-blue);
        }

        .preemption-details {
            flex-grow: 1;
        }

        .preemption-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .preemption-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .preemption-actions {
            display: flex;
            gap: 10px;
            margin-left: 15px;
        }

        .preemption-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .preemption-btn.acknowledge {
            background-color: var(--primary-blue);
            color: var(--white);
        }

        .preemption-btn.execute {
            background-color: var(--status-red);
            color: var(--white);
        }

        .preemption-btn:hover {
            opacity: 0.9;
        }

        /* Scaling Alerts */
        .scaling-alert {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border: 1px solid var(--border-grey);
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--white);
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .alert-expand {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        .alert-maintain {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .alert-critical {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .alert-details {
            flex-grow: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 4px;
        }

        .alert-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .alert-priority {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 15px;
        }

        .priority-high {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--status-red);
        }

        .priority-medium {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--status-yellow);
        }

        .priority-low {
            background-color: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        /* Analytics Dashboard Styles */
        .metrics-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .metric-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(69, 91, 241, 0.1);
            border-radius: 12px;
        }

        .metric-content {
            flex-grow: 1;
        }

        .metric-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .metric-change.positive {
            color: var(--status-green);
        }

        .metric-change.negative {
            color: var(--status-red);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chart-controls select {
            padding: 6px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--white);
        }

        .chart-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 6px;
            background: var(--white);
            color: var(--text-light);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-btn.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .chart-btn:hover {
            border-color: var(--primary-blue);
        }

        .chart-subtitle {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .chart-content {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        /* Performance Metrics specific styling */
        .chart-content .performance-metrics {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 0;
            overflow: hidden;
        }

        .chart-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }

        .chart-bars {
            display: flex;
            align-items: end;
            justify-content: space-evenly;
            height: 150px;
            gap: 1px;
            padding: 0 8px;
        }

        .chart-bar {
            background: linear-gradient(to top, var(--primary-blue), var(--accent-blue));
            border-radius: 4px 4px 0 0;
            width: 25px;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar::after {
            content: attr(data-value);
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-dark);
            white-space: nowrap;
            max-width: 35px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chart-labels {
            display: flex;
            justify-content: space-evenly;
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 10px;
            padding: 0 8px;
        }

        .chart-line {
            width: 100%;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #gpuUtilizationChart, #costAnalysisChart {
            width: 100% !important;
            height: 200px !important;
        }

        .performance-metrics {
            width: 100%;
        }

        .perf-metric {
            display: grid;
            grid-template-columns: 70px 1fr;
            gap: 5px;
            align-items: center;
            margin-bottom: 2px;
            height: 35px;
        }

        .perf-metric:last-child {
            margin-bottom: 0;
        }

        .perf-label {
            font-size: 0.7rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .perf-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        .perf-value {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0px;
        }

        .perf-bar {
            height: 2px;
            background: var(--border-grey);
            border-radius: 1px;
            overflow: hidden;
            margin-bottom: 0px;
        }

        .perf-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            border-radius: 1px;
            transition: width 0.3s ease;
        }

        .perf-detail {
            font-size: 0.6rem;
            color: var(--text-light);
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .resource-distribution {
            width: 100%;
        }

        .resource-item {
            margin-bottom: 15px;
        }

        .resource-label {
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .resource-bar {
            height: 12px;
            background: var(--border-grey);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .resource-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.3s ease;
        }

        .resource-value {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .analytics-table-section {
            background: var(--white);
            border: 1px solid var(--border-grey);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-dark);
            margin: 0;
        }

        .table-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .table-controls select {
            padding: 8px 12px;
            border: 1px solid var(--border-grey);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--white);
        }

        .export-btn {
            background: var(--primary-blue);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: var(--accent-blue);
        }

        .analytics-table-container {
            overflow-x: auto;
        }

        .analytics-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .analytics-table th {
            background: var(--neutral-grey);
            color: var(--text-dark);
            font-weight: 600;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid var(--border-grey);
        }

        .analytics-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-grey);
            color: var(--text-dark);
        }

        .analytics-table tr:hover {
            background: rgba(69, 91, 241, 0.05);
        }

        .utilization-badge {
            background: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .roi-badge {
            background: rgba(69, 91, 241, 0.1);
            color: var(--primary-blue);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .status-badge.status-active {
            background: rgba(34, 197, 94, 0.1);
            color: var(--status-green);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .gpu-panel-container {
                flex-direction: column;
            }

            .gpu-nav {
                width: 100%;
                flex-direction: row;
                overflow-x: auto;
                padding: 15px;
            }

            .nav-section {
                margin-bottom: 0;
                margin-right: 20px;
                min-width: 200px;
            }

            .gpu-main-content {
                padding: 20px;
            }

            .gpu-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            /* Performance Metrics responsive adjustments */
            .chart-content .performance-metrics {
                padding: 5px 0;
            }

            .perf-metric {
                margin-bottom: 10px;
            }

            .perf-label {
                font-size: 0.8rem;
            }

            .perf-value {
                font-size: 1rem;
            }

            .perf-detail {
                font-size: 0.65rem;
            }

            .performance-metrics {
                grid-template-columns: repeat(2, 1fr);
            }

            .chart-controls {
                flex-wrap: wrap;
            }

            .maintenance-modal-content {
                width: 95%;
                max-width: 600px;
                padding: 20px;
            }

            .maintenance-form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .maintenance-form-group.full-width {
                grid-column: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation Bar -->
    <div class="header-bar">
        <div class="branding">
            <img src="includes/Artboard-7.png" alt="Asoba Logo">
            <span class="site-title">Ona Energy Management</span>
        </div>
        <div class="top-links">
            <a href="application-select.html">Applications</a>
            <a href="server-management.html">Offtaker Management</a>
            <a href="admin-gpu-panel.html" style="color: var(--primary-blue);">O&M Management</a>
            <a href="#" onclick="logout(); return false;" style="color: var(--status-red);">Logout</a>
        </div>
    </div>

    <main>
        <div class="gpu-panel-container">
            <!-- Navigation Sidebar -->
            <nav class="gpu-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <button class="nav-button active" data-section="dashboard">
                        <span class="nav-icon">📊</span>
                        Dashboard
                    </button>
                    <button class="nav-button" data-section="inventory">
                        <span class="nav-icon">🖥️</span>
                        Inventory
                    </button>
                    <button class="nav-button" data-section="allocation">
                        <span class="nav-icon">⚡</span>
                        Resource Allocation
                    </button>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Monitoring</div>
                    <button class="nav-button" data-section="performance">
                        <span class="nav-icon">📈</span>
                        Performance
                    </button>
                    <button class="nav-button" data-section="maintenance">
                        <span class="nav-icon">🔧</span>
                        Maintenance
                    </button>
                    <button class="nav-button" data-section="analytics">
                        <span class="nav-icon">📊</span>
                        Analytics
                    </button>
                </div>
            </nav>

            <!-- Main Content Area -->
            <div class="gpu-main-content">
                <!-- Dashboard Section -->
                <div class="content-section active" id="dashboard">
                    <div class="section-header">
                        <h1 class="section-title">Dashboard</h1>
                        <p class="section-subtitle">Real-time monitoring and management of energy infrastructure</p>
                    </div>

                    <!-- Metrics Overview -->
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="metric-value" id="totalInverters">11</span>
                            <span class="metric-label">Total Inverters</span>
                            <span class="metric-change positive">+4 this month</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="activeInverters">11</span>
                            <span class="metric-label">Active Inverters</span>
                            <span class="metric-change positive">75% utilization</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="avgUtilization">78%</span>
                            <span class="metric-label">Avg Utilization</span>
                            <span class="metric-change positive">+5% from yesterday</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="activeJobs">12</span>
                            <span class="metric-label">Active Jobs</span>
                            <span class="metric-change positive">+3 this hour</span>
                        </div>
                    </div>

                    <!-- Solar Sites Grid -->
                    <div class="gpu-grid" id="solarSitesGrid">
                        <!-- Solar site cards -->
                        <div class="gpu-card">
                            <div class="gpu-header">
                                <div class="gpu-name">Cummins Midrand</div>
                                <div class="gpu-status status-active">Active</div>
                            </div>
                            <div class="gpu-specs">
                                <div class="spec-row">
                                    <span class="spec-label">Type:</span>
                                    <span class="spec-value">Commercial</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Capacity:</span>
                                    <span class="spec-value">821.88 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Location:</span>
                                    <span class="spec-value">Corners Bridal Veil Road</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Current Output:</span>
                                    <span class="spec-value">0 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Efficiency:</span>
                                    <span class="spec-value">0%</span>
                                </div>
                            </div>
                            <div class="gpu-actions">
                                <button class="action-btn primary" onclick="viewSiteDetails('cummins-midrand')">View Details</button>
                                <button class="action-btn secondary" onclick="manageSite('cummins-midrand')">Manage</button>
                            </div>
                        </div>

                        <div class="gpu-card">
                            <div class="gpu-header">
                                <div class="gpu-name">FNB Willowbridge</div>
                                <div class="gpu-status status-active">Active</div>
                            </div>
                            <div class="gpu-specs">
                                <div class="spec-row">
                                    <span class="spec-label">Type:</span>
                                    <span class="spec-value">Commercial</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Capacity:</span>
                                    <span class="spec-value">51.98 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Location:</span>
                                    <span class="spec-value">61 Carl Cronje Drive</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Current Output:</span>
                                    <span class="spec-value">0 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Efficiency:</span>
                                    <span class="spec-value">0%</span>
                                </div>
                            </div>
                            <div class="gpu-actions">
                                <button class="action-btn primary" onclick="viewSiteDetails('fnb-willowbridge')">View Details</button>
                                <button class="action-btn secondary" onclick="manageSite('fnb-willowbridge')">Manage</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Section -->
                <div class="content-section" id="inventory">
                    <div class="section-header">
                        <h1 class="section-title">Asset Inventory</h1>
                        <p class="section-subtitle">Solar site specifications and asset tracking</p>
                        <div style="margin-top: 15px;">
                            <button class="config-btn primary" onclick="openAddSiteModal()" style="padding: 12px 24px; font-size: 1rem;">
                                ➕ Add New Site
                            </button>
                        </div>
                    </div>

                    <div class="gpu-grid" id="inventoryGrid">
                        <!-- Site inventory cards -->
                        <div class="inventory-card">
                            <div class="inventory-header">
                                <div class="inventory-name">Cummins Midrand</div>
                                <div class="inventory-status status-active">Active</div>
                            </div>
                            <div class="inventory-specs">
                                <div class="spec-row">
                                    <span class="spec-label">Type:</span>
                                    <span class="spec-value">Commercial Solar</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Capacity:</span>
                                    <span class="spec-value">821.88 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Inverters:</span>
                                    <span class="spec-value">9 units</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Location:</span>
                                    <span class="spec-value">Corners Bridal Veil Road</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Commissioned:</span>
                                    <span class="spec-value">2024-01-15</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Next Maintenance:</span>
                                    <span class="maintenance-value">Dec 15, 2024</span>
                                </div>
                            </div>
                            <div class="inventory-actions">
                                <button class="action-btn primary" onclick="viewSiteInventoryDetails('cummins-midrand')">View Details</button>
                                <button class="action-btn secondary" onclick="scheduleSiteMaintenance('cummins-midrand')">Maintenance</button>
                                <button class="action-btn tertiary" onclick="viewSiteComponents('cummins-midrand')">Components</button>
                            </div>
                        </div>

                        <div class="inventory-card">
                            <div class="inventory-header">
                                <div class="inventory-name">FNB Willowbridge</div>
                                <div class="inventory-status status-active">Active</div>
                            </div>
                            <div class="inventory-specs">
                                <div class="spec-row">
                                    <span class="spec-label">Type:</span>
                                    <span class="spec-value">Commercial Solar</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Capacity:</span>
                                    <span class="spec-value">51.98 kW</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Inverters:</span>
                                    <span class="spec-value">2 units</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Location:</span>
                                    <span class="spec-value">61 Carl Cronje Drive</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Commissioned:</span>
                                    <span class="spec-value">2024-02-20</span>
                                </div>
                                <div class="spec-row">
                                    <span class="spec-label">Next Maintenance:</span>
                                    <span class="maintenance-value">Dec 10, 2024</span>
                                </div>
                            </div>
                            <div class="inventory-actions">
                                <button class="action-btn primary" onclick="viewSiteInventoryDetails('fnb-willowbridge')">View Details</button>
                                <button class="action-btn secondary" onclick="scheduleSiteMaintenance('fnb-willowbridge')">Maintenance</button>
                                <button class="action-btn tertiary" onclick="viewSiteComponents('fnb-willowbridge')">Components</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resource Allocation Section -->
                <div class="content-section" id="allocation">
                    <div class="section-header">
                        <h1 class="section-title">Capacity Management</h1>
                        <p class="section-subtitle">Infrastructure capacity allocation and resource availability across distributed sites</p>
                    </div>

                    <!-- Capacity Overview -->
                    <div class="metrics-grid" style="margin-bottom: 30px;">
                        <div class="metric-card">
                            <span class="metric-value" id="totalCapacity">24</span>
                            <span class="metric-label">Total GPU Capacity</span>
                            <span class="metric-change positive">+4 this month</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="ondemandCapacity">18</span>
                            <span class="metric-label">On-Demand Reserved</span>
                            <span class="metric-change positive">75% utilization</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="spotCapacity">6</span>
                            <span class="metric-label">Spot Available</span>
                            <span class="metric-change negative">25% capacity</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value" id="capacityHealth">92%</span>
                            <span class="metric-label">Capacity Health</span>
                            <span class="metric-change positive">+3% from yesterday</span>
                        </div>
                    </div>

                    <!-- Capacity Allocation by Site -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">Capacity Allocation by Site</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-view="all">All Sites</button>
                                <button class="chart-btn" data-view="ondemand">On-Demand</button>
                                <button class="chart-btn" data-view="spot">Spot Available</button>
                            </div>
                        </div>
                        <div id="capacityAllocation">
                            <!-- Capacity allocation will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Preemption Management -->
                    <div class="chart-container" style="margin-bottom: 30px;">
                        <div class="chart-header">
                            <h3 class="chart-title">Preemption Management</h3>
                        </div>
                        <div id="preemptionStatus">
                            <!-- Preemption status will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Infrastructure Scaling Alerts -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Capacity Planning & Alerts</h3>
                        </div>
                        <div id="scalingAlerts">
                            <!-- Scaling alerts will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Performance Section -->
                <div class="content-section" id="performance">
                    <div class="section-header">
                        <h1 class="section-title">Performance Monitoring</h1>
                        <p class="section-subtitle">Real-time metrics and system health</p>
                    </div>

                    <!-- Site Selector -->
                    <div class="gpu-selector-section" style="margin-bottom: 30px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <label for="siteSelector" style="font-weight: 600; color: var(--text-dark);">Monitor Individual Site:</label>
                            <select id="siteSelector" style="padding: 8px 12px; border: 1px solid var(--border-grey); border-radius: 6px; font-family: 'DM Sans', sans-serif; font-size: 1rem; background-color: var(--white); cursor: pointer; min-width: 200px;">
                                <option value="all">All Sites (Average)</option>
                                <option value="cummins-midrand">Cummins Midrand</option>
                                <option value="fnb-willowbridge">FNB Willowbridge</option>
                            </select>
                            <button class="config-btn secondary" onclick="refreshSiteData()" style="padding: 8px 16px; font-size: 0.9rem;">
                                🔄 Refresh Data
                            </button>
                        </div>
                    </div>

                    <!-- Performance Metrics Overview -->
                    <div class="performance-metrics">
                        <div class="performance-card">
                            <div class="performance-value" id="gpuUtilization">78%</div>
                            <div class="performance-label" id="utilizationLabel">Average Site Utilization</div>
                            <div class="performance-trend trend-up" id="utilizationTrend">↗ +5% from yesterday</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="gpuTemperature">67°C</div>
                            <div class="performance-label" id="temperatureLabel">Average Temperature</div>
                            <div class="performance-trend trend-stable" id="temperatureTrend">→ Stable</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="gpuPower">185W</div>
                            <div class="performance-label" id="powerLabel">Average Power Draw</div>
                            <div class="performance-trend trend-down" id="powerTrend">↘ -12W from yesterday</div>
                        </div>
                        <div class="performance-card">
                            <div class="performance-value" id="gpuMemory">72%</div>
                            <div class="performance-label" id="memoryLabel">Memory Utilization</div>
                            <div class="performance-trend trend-up" id="memoryTrend">↗ +8% from yesterday</div>
                        </div>
                    </div>

                    <!-- Utilization Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title" id="utilizationChartTitle">Site Utilization Over Time</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-period="1h">1 Hour</button>
                                <button class="chart-btn" data-period="6h">6 Hours</button>
                                <button class="chart-btn" data-period="24h">24 Hours</button>
                                <button class="chart-btn" data-period="7d">7 Days</button>
                            </div>
                        </div>
                        <div class="chart-canvas" id="utilizationChart">
                            <canvas id="utilizationChartCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Temperature Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title" id="temperatureChartTitle">Temperature Monitoring</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-period="1h">1 Hour</button>
                                <button class="chart-btn" data-period="6h">6 Hours</button>
                                <button class="chart-btn" data-period="24h">24 Hours</button>
                            </div>
                        </div>
                        <div class="chart-canvas" id="temperatureChart">
                            <canvas id="temperatureChartCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Power Consumption Chart -->
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title" id="powerChartTitle">Power Consumption</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-period="1h">1 Hour</button>
                                <button class="chart-btn" data-period="6h">6 Hours</button>
                                <button class="chart-btn" data-period="24h">24 Hours</button>
                            </div>
                        </div>
                        <div class="chart-canvas" id="powerChart">
                            <canvas id="powerChartCanvas"></canvas>
                        </div>
                    </div>

                    <!-- Active Alerts -->
                    <div class="alerts-section">
                        <h3 style="margin-bottom: 20px; color: var(--text-dark);">Active Alerts</h3>
                        <div class="alert-item">
                            <div class="alert-icon warning">⚠</div>
                            <div class="alert-content">
                                <div class="alert-title">Low Power Output - Cummins Midrand</div>
                                <div class="alert-time">5 minutes ago</div>
                            </div>
                            <div class="alert-actions">
                                <button class="alert-btn acknowledge" onclick="acknowledgeAlert('power-001')">Acknowledge</button>
                                <button class="alert-btn resolve" onclick="resolveAlert('power-001')">Resolve</button>
                            </div>
                        </div>
                        <div class="alert-item">
                            <div class="alert-icon info">ℹ</div>
                            <div class="alert-content">
                                <div class="alert-title">Inverter Maintenance Scheduled - FNB Willowbridge</div>
                                <div class="alert-time">15 minutes ago</div>
                            </div>
                            <div class="alert-actions">
                                <button class="alert-btn acknowledge" onclick="acknowledgeAlert('maint-001')">Acknowledge</button>
                                <button class="alert-btn resolve" onclick="resolveAlert('maint-001')">Resolve</button>
                            </div>
                        </div>
                        <div class="alert-item">
                            <div class="alert-icon critical">!</div>
                            <div class="alert-content">
                                <div class="alert-title">Weather Alert: Storm Warning - All Sites</div>
                                <div class="alert-time">2 hours ago</div>
                            </div>
                            <div class="alert-actions">
                                <button class="alert-btn acknowledge" onclick="acknowledgeAlert('weather-001')">Acknowledge</button>
                                <button class="alert-btn resolve" onclick="resolveAlert('weather-001')">Resolve</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Maintenance Section -->
                <div class="content-section" id="maintenance">
                    <div class="section-header">
                        <h1 class="section-title">Maintenance & Updates</h1>
                        <p class="section-subtitle">Driver management and hardware maintenance</p>
                    </div>

                    <!-- Scheduled Maintenance Tasks -->
                    <div class="maintenance-grid" id="maintenanceGrid">
                        <!-- Maintenance cards will be populated by JavaScript -->
                    </div>

                    <!-- Driver Management -->
                    <div class="driver-section">
                        <h3 style="margin-bottom: 20px; color: var(--text-dark);">GPU Driver Management</h3>
                        <div class="driver-grid" id="driverGrid">
                            <!-- Driver cards will be populated by JavaScript -->
                        </div>
                        <div style="text-align: center;">
                            <button class="config-btn primary" onclick="checkDriverUpdates()">
                                🔍 Check for Updates
                            </button>
                        </div>
                    </div>

                    <!-- System Configuration -->
                    <div class="config-section">
                        <h3 style="margin-bottom: 20px; color: var(--text-dark);">System Configuration</h3>
                        <div class="config-form">
                            <div class="config-group">
                                <label for="powerLimit">GPU Power Limit (%)</label>
                                <input type="number" id="powerLimit" min="50" max="100" value="100">
                            </div>
                            <div class="config-group">
                                <label for="tempThreshold">Temperature Threshold (°C)</label>
                                <input type="number" id="tempThreshold" min="60" max="90" value="85">
                            </div>
                            <div class="config-group">
                                <label for="autoMaintenance">Auto Maintenance</label>
                                <select id="autoMaintenance">
                                    <option value="enabled" selected>Enabled</option>
                                    <option value="disabled">Disabled</option>
                                </select>
                            </div>
                            <div class="config-group">
                                <label for="maintenanceWindow">Maintenance Window</label>
                                <select id="maintenanceWindow">
                                    <option value="weekend">Weekend (Sat-Sun)</option>
                                    <option value="nightly">Nightly (2AM-4AM)</option>
                                    <option value="manual" selected>Manual Only</option>
                                </select>
                            </div>
                            <div class="config-group">
                                <label for="alertEmail">Alert Email</label>
                                <input type="email" id="alertEmail" placeholder="admin@company.com" value="admin@asoba.co">
                            </div>
                            <div class="config-group">
                                <label for="backupRetention">Backup Retention (days)</label>
                                <input type="number" id="backupRetention" min="7" max="365" value="30">
                            </div>
                        </div>
                        <div class="config-actions">
                            <button class="config-btn primary" onclick="saveConfiguration()">
                                💾 Save Configuration
                            </button>
                            <button class="config-btn secondary" onclick="resetConfiguration()">
                                🔄 Reset to Defaults
                            </button>
                        </div>
                    </div>

                    <!-- Hardware Maintenance Log -->
                    <div class="config-section">
                        <h3 style="margin-bottom: 20px; color: var(--text-dark);">Maintenance History</h3>
                        <div id="maintenanceHistory">
                            <!-- Maintenance history will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div class="content-section" id="analytics">
                    <div class="section-header">
                        <h1 class="section-title">Analytics Dashboard</h1>
                        <p class="section-subtitle">Comprehensive GPU performance, usage, and cost analytics</p>
                    </div>

                    <!-- Key Metrics Overview -->
                    <div class="metrics-overview">
                        <div class="metric-card">
                            <div class="metric-icon">💰</div>
                            <div class="metric-content">
                                <div class="metric-value" id="totalCost">$12,847</div>
                                <div class="metric-label">Total Cost (30 days)</div>
                                <div class="metric-change positive">-8.2% vs last month</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">⚡</div>
                            <div class="metric-content">
                                <div class="metric-value" id="analyticsAvgUtilization">87.3%</div>
                                <div class="metric-label">Avg Site Utilization</div>
                                <div class="metric-change positive">+5.1% vs last month</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">🎯</div>
                            <div class="metric-content">
                                <div class="metric-value" id="roi">342%</div>
                                <div class="metric-label">ROI</div>
                                <div class="metric-change positive">+12% vs last month</div>
                            </div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon">⏱️</div>
                            <div class="metric-content">
                                <div class="metric-value" id="uptime">99.7%</div>
                                <div class="metric-label">Uptime</div>
                                <div class="metric-change positive">+0.3% vs last month</div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div class="charts-grid">
                        <!-- Cost Analysis Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Cost Analysis</h3>
                                <div class="chart-controls">
                                    <select id="costTimeframe">
                                        <option value="7d">Last 7 days</option>
                                        <option value="30d" selected>Last 30 days</option>
                                        <option value="90d">Last 90 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-content">
                                <div class="chart-placeholder" id="analyticsCostChart">
                                    <canvas id="costAnalysisChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Site Utilization Chart -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Site Utilization</h3>
                                <div class="chart-controls">
                                    <select id="utilizationTimeframe">
                                        <option value="24h">Last 24 hours</option>
                                        <option value="7d" selected>Last 7 days</option>
                                        <option value="30d">Last 30 days</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-content">
                                <div class="chart-placeholder" id="analyticsUtilizationChart">
                                    <div class="chart-line">
                                        <canvas id="gpuUtilizationChart" width="400" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Performance Metrics</h3>
                                <div class="chart-controls">
                                    <span class="chart-subtitle">Real-time Performance</span>
                                </div>
                            </div>
                            <div class="chart-content">
                                <div class="performance-metrics">
                                    <div class="perf-metric">
                                        <div class="perf-label">Throughput</div>
                                        <div class="perf-content">
                                            <div class="perf-value">2,847 req/s</div>
                                            <div class="perf-bar">
                                                <div class="perf-fill" style="width: 87%;"></div>
                                            </div>
                                            <div class="perf-detail">Peak: 3,200 req/s | Avg: 2,650 req/s</div>
                                        </div>
                                    </div>
                                    <div class="perf-metric">
                                        <div class="perf-label">Latency</div>
                                        <div class="perf-content">
                                            <div class="perf-value">12.3ms</div>
                                            <div class="perf-bar">
                                                <div class="perf-fill" style="width: 92%;"></div>
                                            </div>
                                            <div class="perf-detail">P95: 18.7ms | P99: 25.4ms</div>
                                        </div>
                                    </div>
                                    <div class="perf-metric">
                                        <div class="perf-label">Accuracy</div>
                                        <div class="perf-content">
                                            <div class="perf-value">98.7%</div>
                                            <div class="perf-bar">
                                                <div class="perf-fill" style="width: 98%;"></div>
                                            </div>
                                            <div class="perf-detail">Precision: 97.2% | Recall: 96.8%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Resource Distribution -->
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3>Resource Distribution</h3>
                                <div class="chart-controls">
                                    <span class="chart-subtitle">By GPU Type</span>
                                </div>
                            </div>
                            <div class="chart-content">
                                <div class="resource-distribution">
                                    <div class="resource-item">
                                        <div class="resource-label">NVIDIA A100</div>
                                        <div class="resource-bar">
                                            <div class="resource-fill" style="width: 45%; background: #455BF1;"></div>
                                        </div>
                                        <div class="resource-value">45% (18 GPUs)</div>
                                    </div>
                                    <div class="resource-item">
                                        <div class="resource-label">NVIDIA V100</div>
                                        <div class="resource-bar">
                                            <div class="resource-fill" style="width: 30%; background: #22C55E;"></div>
                                        </div>
                                        <div class="resource-value">30% (12 GPUs)</div>
                                    </div>
                                    <div class="resource-item">
                                        <div class="resource-label">NVIDIA RTX 4090</div>
                                        <div class="resource-bar">
                                            <div class="resource-fill" style="width: 25%; background: #F59E0B;"></div>
                                        </div>
                                        <div class="resource-value">25% (10 GPUs)</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Analytics Table -->
                    <div class="analytics-table-section">
                        <div class="table-header">
                            <h3>Detailed Analytics</h3>
                            <div class="table-controls">
                                <select id="analyticsFilter">
                                    <option value="all">All GPUs</option>
                                    <option value="a100">NVIDIA A100</option>
                                    <option value="v100">NVIDIA V100</option>
                                    <option value="rtx4090">NVIDIA RTX 4090</option>
                                </select>
                                <button class="export-btn">📊 Export Data</button>
                            </div>
                        </div>
                        <div class="analytics-table-container">
                            <table class="analytics-table">
                                <thead>
                                    <tr>
                                        <th>GPU ID</th>
                                        <th>Type</th>
                                        <th>Utilization</th>
                                        <th>Cost/Hour</th>
                                        <th>Revenue/Hour</th>
                                        <th>ROI</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="analyticsTableBody">
                                    <!-- Table rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Maintenance Task Creation Modal -->
    <div id="maintenanceModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title" id="maintenanceModalTitle">Create Maintenance Task</h3>
                <button class="maintenance-modal-close" onclick="closeMaintenanceModal()">&times;</button>
            </div>
            
            <form id="maintenanceForm">
                <div class="maintenance-form-grid">
                    <div class="maintenance-form-group">
                        <label for="maintenanceType">Maintenance Type</label>
                        <select id="maintenanceType" required>
                            <option value="driver">Driver Update</option>
                            <option value="firmware">Firmware Update</option>
                            <option value="inspection">Hardware Inspection</option>
                            <option value="repair">Repair</option>
                            <option value="replace">Replace</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="maintenancePriority">Priority</label>
                        <select id="maintenancePriority" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="maintenanceDate">Scheduled Date</label>
                        <input type="date" id="maintenanceDate" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="maintenanceDuration">Estimated Duration</label>
                        <select id="maintenanceDuration" required>
                            <option value="15 minutes">15 minutes</option>
                            <option value="30 minutes" selected>30 minutes</option>
                            <option value="1 hour">1 hour</option>
                            <option value="2 hours">2 hours</option>
                            <option value="4 hours">4 hours</option>
                            <option value="8 hours">8 hours</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="maintenanceTechnician">Assigned Technician</label>
                        <select id="maintenanceTechnician" required>
                            <option value="John Smith">John Smith</option>
                            <option value="Sarah Johnson">Sarah Johnson</option>
                            <option value="Mike Davis">Mike Davis</option>
                            <option value="Lisa Chen">Lisa Chen</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="maintenanceDescription">Description</label>
                        <textarea id="maintenanceDescription" placeholder="Describe the maintenance task details..." required></textarea>
                    </div>
                </div>
                
                <div class="maintenance-modal-actions">
                    <button type="button" class="maintenance-modal-btn secondary" onclick="closeMaintenanceModal()">Cancel</button>
                    <button type="submit" class="maintenance-modal-btn primary">Create Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Site Details Modal -->
    <div id="siteDetailsModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Site Details</h3>
                <button class="maintenance-modal-close" onclick="closeSiteDetailsModal()">&times;</button>
            </div>
            
            <div class="site-details-content">
                <div class="site-details-section">
                    <h4>Basic Information</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Site Name:</span>
                            <span class="detail-value" id="detailSiteName">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Site Type:</span>
                            <span class="detail-value" id="detailSiteType">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value" id="detailLocation">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Capacity:</span>
                            <span class="detail-value" id="detailCapacity">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Technical Specifications</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Inverter Count:</span>
                            <span class="detail-value" id="detailInverterCount">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Panel Count:</span>
                            <span class="detail-value" id="detailPanelCount">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Panel Wattage:</span>
                            <span class="detail-value" id="detailPanelWattage">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Inverter Brand:</span>
                            <span class="detail-value" id="detailInverterBrand">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Status & Maintenance</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value" id="detailStatus">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Commission Date:</span>
                            <span class="detail-value" id="detailCommissionDate">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Next Maintenance:</span>
                            <span class="detail-value" id="detailNextMaintenance">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Grid Connection:</span>
                            <span class="detail-value" id="detailGridConnection">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Performance Metrics</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Current Utilization:</span>
                            <span class="detail-value" id="detailUtilization">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temperature:</span>
                            <span class="detail-value" id="detailTemperature">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Power Output:</span>
                            <span class="detail-value" id="detailPower">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Efficiency:</span>
                            <span class="detail-value" id="detailEfficiency">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Notes</h4>
                    <div class="detail-item full-width">
                        <span class="detail-value" id="detailNotes">-</span>
                    </div>
                </div>
            </div>
            
            <div class="maintenance-modal-actions">
                <button type="button" class="maintenance-modal-btn secondary" onclick="closeSiteDetailsModal()">Close</button>
                <button type="button" class="maintenance-modal-btn primary" onclick="editSiteDetails()">Edit Site</button>
            </div>
        </div>
    </div>

    <!-- Site Maintenance Modal -->
    <div id="siteMaintenanceModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Schedule Site Maintenance</h3>
                <button class="maintenance-modal-close" onclick="closeSiteMaintenanceModal()">&times;</button>
            </div>
            
            <form id="siteMaintenanceForm">
                <div class="maintenance-form-grid">
                    <div class="maintenance-form-group">
                        <label for="maintenanceSiteName">Site Name</label>
                        <input type="text" id="maintenanceSiteName" readonly>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteMaintenanceType">Maintenance Type</label>
                        <select id="siteMaintenanceType" required>
                            <option value="">Select maintenance type</option>
                            <option value="panel-cleaning">Panel Cleaning</option>
                            <option value="inverter-inspection">Inverter Inspection</option>
                            <option value="performance-testing">Performance Testing</option>
                            <option value="connection-check">Connection Check</option>
                            <option value="documentation-update">Documentation Update</option>
                            <option value="preventive-maintenance">Preventive Maintenance</option>
                            <option value="emergency-repair">Emergency Repair</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteMaintenanceDate">Scheduled Date</label>
                        <input type="date" id="siteMaintenanceDate" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteMaintenancePriority">Priority</label>
                        <select id="siteMaintenancePriority" required>
                            <option value="">Select priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteMaintenanceDuration">Estimated Duration (hours)</label>
                        <input type="number" id="siteMaintenanceDuration" placeholder="e.g., 4" min="1" max="24" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteMaintenanceTechnician">Assigned Technician</label>
                        <input type="text" id="siteMaintenanceTechnician" placeholder="e.g., John Smith" required>
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="siteMaintenanceDescription">Description</label>
                        <textarea id="siteMaintenanceDescription" placeholder="Detailed description of maintenance tasks, requirements, and special instructions..." rows="4"></textarea>
                    </div>
                </div>
                
                <div class="maintenance-modal-actions">
                    <button type="button" class="maintenance-modal-btn secondary" onclick="closeSiteMaintenanceModal()">Cancel</button>
                    <button type="submit" class="maintenance-modal-btn primary">Schedule Maintenance</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Site Modal -->
    <div id="addSiteModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Add New Solar Site</h3>
                <button class="maintenance-modal-close" onclick="closeAddSiteModal()">&times;</button>
            </div>
            
            <form id="addSiteForm">
                <div class="maintenance-form-grid">
                    <div class="maintenance-form-group">
                        <label for="siteName">Site Name</label>
                        <input type="text" id="siteName" placeholder="e.g., Corporate Office Building" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteType">Site Type</label>
                        <select id="siteType" required>
                            <option value="">Select Type</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Residential">Residential</option>
                            <option value="Utility">Utility Scale</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteLocation">Address</label>
                        <input type="text" id="siteLocation" placeholder="e.g., 123 Main Street, City" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="siteCapacity">Total Capacity (kW)</label>
                        <input type="number" id="siteCapacity" placeholder="e.g., 500.5" step="0.01" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="inverterCount">Number of Inverters</label>
                        <input type="number" id="inverterCount" placeholder="e.g., 5" min="1" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="commissionDate">Commission Date</label>
                        <input type="date" id="commissionDate" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="panelCount">Number of Panels</label>
                        <input type="number" id="panelCount" placeholder="e.g., 2000" min="1" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="panelWattage">Panel Wattage (W)</label>
                        <input type="number" id="panelWattage" placeholder="e.g., 400" min="100" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="inverterBrand">Inverter Brand</label>
                        <select id="inverterBrand" required>
                            <option value="">Select Brand</option>
                            <option value="SMA">SMA</option>
                            <option value="Fronius">Fronius</option>
                            <option value="SolarEdge">SolarEdge</option>
                            <option value="Huawei">Huawei</option>
                            <option value="ABB">ABB</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="gridConnection">Grid Connection</label>
                        <select id="gridConnection" required>
                            <option value="Single Phase">Single Phase</option>
                            <option value="Three Phase">Three Phase</option>
                            <option value="High Voltage">High Voltage</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="siteNotes">Additional Notes</label>
                        <textarea id="siteNotes" placeholder="Installation details, special requirements, access instructions, etc."></textarea>
                    </div>
                </div>
                
                <div class="maintenance-modal-actions">
                    <button type="button" class="maintenance-modal-btn secondary" onclick="closeAddSiteModal()">Cancel</button>
                    <button type="button" class="maintenance-modal-btn secondary" onclick="testSiteConnection()" id="testSiteConnectionBtn">🔍 Test Connection</button>
                    <button type="submit" class="maintenance-modal-btn primary" id="addSiteBtn">Add Site to Inventory</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Job Modal -->
    <div id="jobModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Create New Compute Job</h3>
                <button class="maintenance-modal-close" onclick="closeJobModal()">&times;</button>
            </div>
            
            <form id="jobForm">
                <div class="maintenance-form-grid">
                    <div class="maintenance-form-group">
                        <label for="jobName">Job Name</label>
                        <input type="text" id="jobName" placeholder="e.g., ML Training Batch 001" required>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobType">Job Type</label>
                        <select id="jobType" required>
                            <option value="">Select Type</option>
                            <option value="training">Machine Learning Training</option>
                            <option value="inference">Model Inference</option>
                            <option value="simulation">Scientific Simulation</option>
                            <option value="rendering">3D Rendering</option>
                            <option value="analysis">Data Analysis</option>
                            <option value="custom">Custom Workload</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobPriority">Priority</label>
                        <select id="jobPriority" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobDuration">Estimated Duration</label>
                        <select id="jobDuration" required>
                            <option value="15 minutes">15 minutes</option>
                            <option value="30 minutes">30 minutes</option>
                            <option value="1 hour" selected>1 hour</option>
                            <option value="2 hours">2 hours</option>
                            <option value="4 hours">4 hours</option>
                            <option value="8 hours">8 hours</option>
                            <option value="12 hours">12 hours</option>
                            <option value="24 hours">24 hours</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobMemory">Memory Requirement (GB)</label>
                        <select id="jobMemory" required>
                            <option value="4">4 GB</option>
                            <option value="8" selected>8 GB</option>
                            <option value="16">16 GB</option>
                            <option value="24">24 GB</option>
                            <option value="32">32 GB</option>
                            <option value="40">40 GB</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobGpuType">Preferred GPU Type</label>
                        <select id="jobGpuType" required>
                            <option value="any">Any Available</option>
                            <option value="Tesla V100">Tesla V100</option>
                            <option value="A100">A100</option>
                            <option value="RTX 4090">RTX 4090</option>
                            <option value="H100">H100</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobSite">Preferred Site</label>
                        <select id="jobSite">
                            <option value="any">Any Available Site</option>
                            <option value="Site A - Conyers, GA">Site A - Conyers, GA</option>
                            <option value="Site B - Macon, GA">Site B - Macon, GA</option>
                            <option value="Site C - Augusta, GA">Site C - Augusta, GA</option>
                            <option value="Site D - Savannah, GA">Site D - Savannah, GA</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="jobSchedule">Schedule</label>
                        <select id="jobSchedule" required>
                            <option value="immediate" selected>Run Immediately</option>
                            <option value="scheduled">Schedule for Later</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group" id="scheduleDateGroup" style="display: none;">
                        <label for="jobScheduleDate">Scheduled Date & Time</label>
                        <input type="datetime-local" id="jobScheduleDate">
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="jobScript">Job Script/Command</label>
                        <textarea id="jobScript" placeholder="python train_model.py --epochs 100 --batch-size 32" required></textarea>
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="jobDescription">Job Description</label>
                        <textarea id="jobDescription" placeholder="Describe what this job does, input data, expected output, etc."></textarea>
                    </div>
                </div>
                
                <div class="maintenance-modal-actions">
                    <button type="button" class="maintenance-modal-btn secondary" onclick="closeJobModal()">Cancel</button>
                    <button type="submit" class="maintenance-modal-btn primary">Create Job</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Site Details Modal -->
    <div id="dashboardSiteDetailsModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Site Details</h3>
                <button class="maintenance-modal-close" onclick="closeDashboardSiteDetailsModal()">&times;</button>
            </div>
            
            <div class="site-details-content">
                <div class="site-details-section">
                    <h4>Basic Information</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Site Name:</span>
                            <span class="detail-value" id="dashboardSiteName">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Type:</span>
                            <span class="detail-value" id="dashboardSiteType">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value" id="dashboardLocation">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Capacity:</span>
                            <span class="detail-value" id="dashboardCapacity">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Inverters:</span>
                            <span class="detail-value" id="dashboardInverters">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value" id="dashboardStatus">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Current Performance</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Current Output:</span>
                            <span class="detail-value" id="dashboardCurrentOutput">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Efficiency:</span>
                            <span class="detail-value" id="dashboardEfficiency">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Utilization:</span>
                            <span class="detail-value" id="dashboardUtilization">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Temperature:</span>
                            <span class="detail-value" id="dashboardTemperature">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="site-details-section">
                    <h4>Maintenance</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <span class="detail-label">Last Maintenance:</span>
                            <span class="detail-value" id="dashboardLastMaintenance">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Next Maintenance:</span>
                            <span class="detail-value" id="dashboardNextMaintenance">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="maintenance-modal-actions">
                <button type="button" class="maintenance-modal-btn secondary" onclick="closeDashboardSiteDetailsModal()">Close</button>
                <button type="button" class="maintenance-modal-btn primary" onclick="editSiteDetails()">Edit Details</button>
            </div>
        </div>
    </div>

    <!-- Dashboard Site Management Modal -->
    <div id="dashboardSiteManagementModal" class="maintenance-modal">
        <div class="maintenance-modal-content">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Site Management</h3>
                <button class="maintenance-modal-close" onclick="closeDashboardSiteManagementModal()">&times;</button>
            </div>
            
            <div class="site-details-content">
                <div class="site-details-section">
                    <h4>Managing: <span id="managementSiteName">-</span></h4>
                    <p>Select an action to perform on this solar site:</p>
                </div>
            </div>
            
            <form id="dashboardManagementForm">
                <div class="maintenance-form-grid">
                    <div class="maintenance-form-group">
                        <label for="managementAction">Action</label>
                        <select id="managementAction" required>
                            <option value="">Select Action</option>
                            <option value="schedule-maintenance">Schedule Maintenance</option>
                            <option value="update-firmware">Update Inverter Firmware</option>
                            <option value="configure-settings">Configure Performance Settings</option>
                            <option value="view-logs">View Production Logs</option>
                            <option value="weather-monitor">Monitor Weather Impact</option>
                            <option value="emergency-shutdown">Emergency Shutdown</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group">
                        <label for="managementPriority">Priority</label>
                        <select id="managementPriority" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    
                    <div class="maintenance-form-group full-width">
                        <label for="managementNotes">Notes</label>
                        <textarea id="managementNotes" placeholder="Add any additional notes or instructions..."></textarea>
                    </div>
                </div>
                
                <div class="maintenance-modal-actions">
                    <button type="button" class="maintenance-modal-btn secondary" onclick="closeDashboardSiteManagementModal()">Cancel</button>
                    <button type="submit" class="maintenance-modal-btn primary">Execute Action</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Site Components Modal -->
    <div id="siteComponentsModal" class="maintenance-modal">
        <div class="maintenance-modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <div class="maintenance-modal-header">
                <h3 class="maintenance-modal-title">Site Components - <span id="componentsSiteName">-</span></h3>
                <button class="maintenance-modal-close" onclick="closeSiteComponentsModal()">&times;</button>
            </div>
            
            <div class="site-details-content">
                <!-- Inverters Section -->
                <div class="site-details-section">
                    <h4>Inverters & Power Conversion</h4>
                    <div id="components-inverters" class="components-container">
                        <!-- Components will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Meters Section -->
                <div class="site-details-section">
                    <h4>Meters & Monitoring</h4>
                    <div id="components-meters" class="components-container">
                        <!-- Components will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Monitoring Section -->
                <div class="site-details-section">
                    <h4>Data Monitoring & Communication</h4>
                    <div id="components-monitoring" class="components-container">
                        <!-- Components will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Safety Section -->
                <div class="site-details-section">
                    <h4>Safety & Protection</h4>
                    <div id="components-safety" class="components-container">
                        <!-- Components will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="maintenance-modal-actions">
                <button type="button" class="maintenance-modal-btn secondary" onclick="closeSiteComponentsModal()">Close</button>
                <button type="button" class="maintenance-modal-btn primary" onclick="exportComponentsList()">Export Components List</button>
            </div>
        </div>
    </div>

    <script>
        // Authentication check
        function checkAuth() {
            const isAuthenticated = sessionStorage.getItem('authenticated') === 'true';
            if (!isAuthenticated) {
                window.location.href = 'index.html';
                return false;
            }
            return true;
        }

        // Check authentication on page load
        if (!checkAuth()) {
            // Redirect will happen in checkAuth function
        }

        // Global functions
        function logout() {
            sessionStorage.removeItem('authenticated');
            window.location.href = 'index.html';
        }
        
        function closeJobModal() {
            document.getElementById('jobModal').style.display = 'none';
            document.getElementById('jobForm').reset();
        }
        
        function loadInventoryCards() {
            // This function would refresh the inventory display
            // For now, it's a placeholder since we're using static HTML
            console.log('Inventory cards refreshed');
        }
        
        // Site inventory management functions
        function viewSiteInventoryDetails(siteId) {
            const site = siteAssets.find(s => s.id === siteId);
            if (!site) return;
            
            // Get current performance data
            const cachedData = getCachedSiteData(siteId);
            
            // Populate the modal with site data
            document.getElementById('detailSiteName').textContent = site.name;
            document.getElementById('detailSiteType').textContent = site.type;
            document.getElementById('detailLocation').textContent = site.location;
            document.getElementById('detailCapacity').textContent = site.capacity + ' kW';
            document.getElementById('detailInverterCount').textContent = site.inverterCount;
            document.getElementById('detailPanelCount').textContent = site.panelCount.toLocaleString();
            document.getElementById('detailPanelWattage').textContent = site.panelWattage + 'W';
            document.getElementById('detailInverterBrand').textContent = site.inverterBrand;
            document.getElementById('detailStatus').textContent = site.status.charAt(0).toUpperCase() + site.status.slice(1);
            document.getElementById('detailCommissionDate').textContent = new Date(site.commissionDate).toLocaleDateString();
            document.getElementById('detailNextMaintenance').textContent = 'Dec 15, 2024'; // Static for now
            document.getElementById('detailGridConnection').textContent = site.gridConnection;
            document.getElementById('detailNotes').textContent = site.notes || 'No additional notes';
            
            // Add current performance metrics
            if (cachedData) {
                document.getElementById('detailUtilization').textContent = cachedData.utilization + '%';
                document.getElementById('detailTemperature').textContent = cachedData.temperature + '°C';
                document.getElementById('detailPower').textContent = cachedData.power + ' kW';
                document.getElementById('detailEfficiency').textContent = cachedData.efficiency + '%';
            } else {
                document.getElementById('detailUtilization').textContent = '0%';
                document.getElementById('detailTemperature').textContent = '25°C';
                document.getElementById('detailPower').textContent = '0 kW';
                document.getElementById('detailEfficiency').textContent = '0%';
            }
            
            // Show the modal
            document.getElementById('siteDetailsModal').style.display = 'flex';
        }
        
        function scheduleSiteMaintenance(siteId) {
            const site = siteAssets.find(s => s.id === siteId);
            if (!site) return;
            
            // Set the site name in the form
            document.getElementById('maintenanceSiteName').value = site.name;
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('siteMaintenanceDate').value = tomorrow.toISOString().split('T')[0];
            
            // Reset form
            document.getElementById('siteMaintenanceType').value = '';
            document.getElementById('siteMaintenancePriority').value = '';
            document.getElementById('siteMaintenanceDuration').value = '';
            document.getElementById('siteMaintenanceTechnician').value = '';
            document.getElementById('siteMaintenanceDescription').value = '';
            
            // Show the modal
            document.getElementById('siteMaintenanceModal').style.display = 'flex';
        }
        
        function viewSiteComponents(siteId) {
            const site = siteAssets.find(s => s.id === siteId);
            if (!site) return;
            
            // Set the site name in the modal
            document.getElementById('componentsSiteName').textContent = site.name;
            
            // Populate component data
            populateSiteComponents(siteId);
            
            // Show the modal
            document.getElementById('siteComponentsModal').style.display = 'flex';
        }
        
        function populateSiteComponents(siteId) {
            // Sample component data for each site
            const componentData = {
                'cummins-midrand': {
                    inverters: [
                        { sku: 'SMA-SUNNY-BOY-5.0', model: 'SMA Sunny Boy 5.0', qty: 9, installDate: '2023-01-15', warranty: '2028-01-15', documents: ['Installation Manual', 'Warranty Certificate'] },
                        { sku: 'SMA-OPTIMIZER-700', model: 'SMA Power Optimizer', qty: 18, installDate: '2023-01-15', warranty: '2028-01-15', documents: ['Technical Specs'] }
                    ],
                    meters: [
                        { sku: 'SCHNEIDER-PM8000', model: 'Schneider PM8000 Power Meter', qty: 2, installDate: '2023-01-15', warranty: '2026-01-15', documents: ['Calibration Certificate', 'Installation Guide'] }
                    ],
                    monitoring: [
                        { sku: 'SOLAREDGE-MONITOR', model: 'SolarEdge Monitoring Gateway', qty: 1, installDate: '2023-01-15', warranty: '2025-01-15', documents: ['Network Configuration', 'User Manual'] }
                    ],
                    safety: [
                        { sku: 'ABB-RCCB-40A', model: 'ABB Residual Current Circuit Breaker', qty: 3, installDate: '2023-01-15', warranty: '2026-01-15', documents: ['Safety Certificate'] }
                    ]
                },
                'fnb-willowbridge': {
                    inverters: [
                        { sku: 'FRONIUS-PRIMO-5.0', model: 'Fronius Primo 5.0', qty: 2, installDate: '2023-03-20', warranty: '2028-03-20', documents: ['Installation Manual', 'Warranty Certificate'] }
                    ],
                    meters: [
                        { sku: 'SCHNEIDER-PM8000', model: 'Schneider PM8000 Power Meter', qty: 1, installDate: '2023-03-20', warranty: '2026-03-20', documents: ['Calibration Certificate'] }
                    ],
                    monitoring: [
                        { sku: 'FRONIUS-DATAMANAGER', model: 'Fronius Data Manager', qty: 1, installDate: '2023-03-20', warranty: '2025-03-20', documents: ['Configuration Guide'] }
                    ],
                    safety: [
                        { sku: 'ABB-RCCB-40A', model: 'ABB Residual Current Circuit Breaker', qty: 1, installDate: '2023-03-20', warranty: '2026-03-20', documents: ['Safety Certificate'] }
                    ]
                }
            };
            
            const components = componentData[siteId] || {};
            
            // Populate each component section
            populateComponentSection('inverters', components.inverters || []);
            populateComponentSection('meters', components.meters || []);
            populateComponentSection('monitoring', components.monitoring || []);
            populateComponentSection('safety', components.safety || []);
        }
        
        function populateComponentSection(sectionType, components) {
            const container = document.getElementById(`components-${sectionType}`);
            if (!container) return;
            
            // Clear existing content
            container.innerHTML = '';
            
            if (components.length === 0) {
                container.innerHTML = '<p class="no-components">No components found. <button class="add-component-btn" onclick="addComponent(\'' + sectionType + '\')">Add Component</button></p>';
                return;
            }
            
            components.forEach((component, index) => {
                const componentDiv = document.createElement('div');
                componentDiv.className = 'component-item';
                componentDiv.innerHTML = `
                    <div class="component-header">
                        <div class="component-info">
                            <h5>${component.model}</h5>
                            <span class="component-sku">SKU: ${component.sku}</span>
                        </div>
                        <div class="component-actions">
                            <button class="component-action-btn" onclick="editComponent('${sectionType}', ${index})">Edit</button>
                            <button class="component-action-btn delete" onclick="deleteComponent('${sectionType}', ${index})">Delete</button>
                        </div>
                    </div>
                    <div class="component-details">
                        <div class="component-detail">
                            <span class="detail-label">Quantity:</span>
                            <span class="detail-value">${component.qty}</span>
                        </div>
                        <div class="component-detail">
                            <span class="detail-label">Install Date:</span>
                            <span class="detail-value">${component.installDate}</span>
                        </div>
                        <div class="component-detail">
                            <span class="detail-label">Warranty Until:</span>
                            <span class="detail-value">${component.warranty}</span>
                        </div>
                        <div class="component-detail">
                            <span class="detail-label">Documents:</span>
                            <span class="detail-value">${component.documents.join(', ')}</span>
                        </div>
                    </div>
                `;
                container.appendChild(componentDiv);
            });
            
            // Add "Add Component" button
            const addButton = document.createElement('div');
            addButton.className = 'add-component-section';
            addButton.innerHTML = `<button class="add-component-btn" onclick="addComponent('${sectionType}')">+ Add ${sectionType.charAt(0).toUpperCase() + sectionType.slice(1)} Component</button>`;
            container.appendChild(addButton);
        }
        
        // Site modal functions
        function openAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'flex';
        }
        
        function closeAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'none';
        }
        
        function closeSiteDetailsModal() {
            document.getElementById('siteDetailsModal').style.display = 'none';
        }
        
        function closeSiteMaintenanceModal() {
            document.getElementById('siteMaintenanceModal').style.display = 'none';
            document.getElementById('siteMaintenanceForm').reset();
        }
        
        function editSiteDetails() {
            alert('Edit functionality coming soon! This will allow you to modify site details.');
        }
        
        // Dashboard modal functions
        function closeDashboardSiteDetailsModal() {
            document.getElementById('dashboardSiteDetailsModal').style.display = 'none';
        }
        
        function closeDashboardSiteManagementModal() {
            document.getElementById('dashboardSiteManagementModal').style.display = 'none';
            document.getElementById('dashboardManagementForm').reset();
        }
        
        function closeSiteComponentsModal() {
            document.getElementById('siteComponentsModal').style.display = 'none';
        }
        
        function addComponent(sectionType) {
            const componentData = prompt(`Add new ${sectionType} component:\n\nEnter component data in format:\nModel,SKU,Quantity,InstallDate,WarrantyDate,Documents\n\nExample:\nSMA Sunny Boy 5.0,SMA-SB-5.0,1,2024-01-15,2029-01-15,Manual,Warranty`);
            
            if (componentData) {
                const parts = componentData.split(',');
                if (parts.length >= 6) {
                    const newComponent = {
                        model: parts[0].trim(),
                        sku: parts[1].trim(),
                        qty: parseInt(parts[2].trim()) || 1,
                        installDate: parts[3].trim(),
                        warranty: parts[4].trim(),
                        documents: parts.slice(5).map(doc => doc.trim())
                    };
                    
                    // Add to component data (in real app, this would save to database)
                    console.log(`Added new ${sectionType} component:`, newComponent);
                    
                    // Refresh the component section
                    const currentSiteId = document.getElementById('componentsSiteName').textContent.toLowerCase().replace(' ', '-');
                    populateSiteComponents(currentSiteId);
                    
                    alert(`Component added successfully!\n\nModel: ${newComponent.model}\nSKU: ${newComponent.sku}\nQuantity: ${newComponent.qty}`);
                } else {
                    alert('Invalid format. Please use: Model,SKU,Quantity,InstallDate,WarrantyDate,Documents');
                }
            }
        }
        
        function editComponent(sectionType, index) {
            alert(`Edit component functionality coming soon!\n\nSection: ${sectionType}\nIndex: ${index}\n\nThis will allow you to modify component details, upload documents, and update specifications.`);
        }
        
        function deleteComponent(sectionType, index) {
            if (confirm(`Are you sure you want to delete this ${sectionType} component?`)) {
                // In real app, this would remove from database
                console.log(`Deleted ${sectionType} component at index ${index}`);
                
                // Refresh the component section
                const currentSiteId = document.getElementById('componentsSiteName').textContent.toLowerCase().replace(' ', '-');
                populateSiteComponents(currentSiteId);
                
                alert('Component deleted successfully!');
            }
        }
        
        function exportComponentsList() {
            const siteName = document.getElementById('componentsSiteName').textContent;
            const componentsData = {
                site: siteName,
                exportDate: new Date().toISOString(),
                components: {
                    inverters: document.getElementById('components-inverters').innerHTML,
                    meters: document.getElementById('components-meters').innerHTML,
                    monitoring: document.getElementById('components-monitoring').innerHTML,
                    safety: document.getElementById('components-safety').innerHTML
                }
            };
            
            // In real app, this would generate a proper export file
            console.log('Components export data:', componentsData);
            
            alert(`Components list exported successfully!\n\nSite: ${siteName}\nExport Date: ${new Date().toLocaleDateString()}\n\nIn a real application, this would generate a CSV or PDF file with all component details and documents.`);
        }
        
        function testSiteConnection() {
            const siteName = document.getElementById('siteName').value;
            const siteLocation = document.getElementById('siteLocation').value;
            const gridConnection = document.getElementById('gridConnection').value;
            
            if (!siteName || !siteLocation || !gridConnection) {
                alert('Please fill in Site Name, Address, and Grid Connection before testing.');
                return;
            }
            
            // Simulate connection test
            const testBtn = document.getElementById('testSiteConnectionBtn');
            const originalText = testBtn.textContent;
            testBtn.textContent = '⏳ Testing...';
            testBtn.disabled = true;
            
            setTimeout(() => {
                testBtn.textContent = originalText;
                testBtn.disabled = false;
                
                if (Math.random() > 0.2) { // 80% success rate
                    alert(`Connection test successful!\n\nSite: ${siteName}\nLocation: ${siteLocation}\nGrid Connection: ${gridConnection}\n\nYou can now add this site to inventory.`);
                } else {
                    alert(`Connection test failed!\n\nPlease check:\n- Site details are correct\n- Network connectivity\n- Grid connection status\n\nTry again after fixing the connection issues.`);
                }
            }, 2000);
        }
        
        // Site data management functions
        function getSiteData(siteId) {
            const sites = {
                'cummins-midrand': {
                    name: 'Cummins Midrand',
                    utilization: 0,      // 0% (no sun currently)
                    temperature: 25,     // 25°C ambient
                    power: 0,           // 0 kW (no production)
                    efficiency: 0,      // 0% efficiency (nighttime)
                    capacity: 821.88    // Total capacity in kW
                },
                'fnb-willowbridge': {
                    name: 'FNB Willowbridge',
                    utilization: 0,      // 0% (no sun currently)
                    temperature: 24,     // 24°C ambient
                    power: 0,           // 0 kW (no production)
                    efficiency: 0,      // 0% efficiency (nighttime)
                    capacity: 51.98     // Total capacity in kW
                }
            };
            return sites[siteId];
        }
        
        // Simulate dynamic site data (optional - adds realistic variation)
        function getRealtimeSiteData(siteId) {
            const baseData = getSiteData(siteId);
            const currentHour = new Date().getHours();
            
            // Calculate solar factor based on time of day
            let solarFactor = 0;
            if (currentHour >= 6 && currentHour <= 18) {
                if (currentHour >= 11 && currentHour <= 15) {
                    solarFactor = 0.8 + (Math.random() * 0.2); // 80-100%
                } else if (currentHour >= 8 && currentHour <= 17) {
                    solarFactor = 0.4 + (Math.random() * 0.4); // 40-80%
                } else {
                    solarFactor = 0.1 + (Math.random() * 0.3); // 10-40%
                }
            }
            
            return {
                utilization: Math.round(solarFactor * 100),
                power: Math.round(baseData.capacity * solarFactor * 100) / 100,
                efficiency: Math.round(solarFactor * 100),
                temperature: baseData.temperature + Math.round(solarFactor * 15) // Panels heat up in sun
            };
        }
        
        // Cache for site data to ensure consistency
        let cachedSiteData = null;
        
        function getCachedSiteData(siteId) {
            // Return cached data if it exists and is recent (within 5 seconds)
            if (cachedSiteData && cachedSiteData.lastUpdate && (Date.now() - cachedSiteData.lastUpdate) < 5000) {
                return cachedSiteData[siteId];
            }
            
            // Generate new cached data
            generateAndCacheSiteData();
            return cachedSiteData[siteId];
        }
        
        function generateAndCacheSiteData() {
            const currentHour = new Date().getHours();
            
            // Calculate solar factor once for this time period
            let solarFactor = 0;
            if (currentHour >= 6 && currentHour <= 18) {
                if (currentHour >= 11 && currentHour <= 15) {
                    solarFactor = 0.8 + (Math.random() * 0.2); // 80-100%
                } else if (currentHour >= 8 && currentHour <= 17) {
                    solarFactor = 0.4 + (Math.random() * 0.4); // 40-80%
                } else {
                    solarFactor = 0.1 + (Math.random() * 0.3); // 10-40%
                }
            }
            
            // Generate consistent data for both sites
            const cumminsBase = getSiteData('cummins-midrand');
            const fnbBase = getSiteData('fnb-willowbridge');
            
            cachedSiteData = {
                'cummins-midrand': {
                    utilization: Math.round(solarFactor * 100),
                    power: Math.round(cumminsBase.capacity * solarFactor * 100) / 100,
                    efficiency: Math.round(solarFactor * 100),
                    temperature: cumminsBase.temperature + Math.round(solarFactor * 15)
                },
                'fnb-willowbridge': {
                    utilization: Math.round(solarFactor * 100),
                    power: Math.round(fnbBase.capacity * solarFactor * 100) / 100,
                    efficiency: Math.round(solarFactor * 100),
                    temperature: fnbBase.temperature + Math.round(solarFactor * 15)
                },
                lastUpdate: Date.now()
            };
            
            cachedSiteData.lastUpdate = Date.now();
        }

        // Sample site data for solar sites
        const siteAssets = [
            {
                id: 'cummins-midrand',
                name: 'Cummins Midrand',
                type: 'Commercial Solar',
                location: 'Corners Bridal Veil Road',
                capacity: 821.88,
                inverterCount: 9,
                commissionDate: '2023-01-15',
                panelCount: 2054,
                panelWattage: 400,
                inverterBrand: 'SMA',
                gridConnection: 'Grid-tied',
                notes: 'Main commercial installation',
                status: 'active',
                utilization: 0,
                temperature: 25,
                power: 0,
                efficiency: 0
            },
            {
                id: 'fnb-willowbridge',
                name: 'FNB Willowbridge',
                type: 'Commercial Solar',
                location: '61 Carl Cronje Drive',
                capacity: 51.98,
                inverterCount: 2,
                commissionDate: '2023-03-20',
                panelCount: 130,
                panelWattage: 400,
                inverterBrand: 'Fronius',
                gridConnection: 'Grid-tied',
                notes: 'Small commercial installation',
                status: 'active',
                utilization: 0,
                temperature: 24,
                power: 0,
                efficiency: 0
            }
        ];

        // Sample GPU data with enhanced inventory information (legacy)
        const gpuAssets = [
            {
                id: 'gpu-001',
                name: 'Tesla V100-01',
                model: 'NVIDIA Tesla V100',
                location: 'Site A - Conyers, GA',
                status: 'active',
                utilization: 85,
                temperature: 72,
                memory: { used: 14.2, total: 16 },
                power: 250,
                jobs: ['ml-training-001', 'inference-batch-003'],
                lastMaintenance: '2024-01-15',
                nextMaintenance: '2024-04-15',
                warranty: { expires: '2025-06-15', status: 'active' },
                purchaseDate: '2023-06-15',
                serialNumber: 'TV100-001-2023',
                firmwareVersion: '1.2.3',
                driverVersion: '535.86.10'
            },
            {
                id: 'gpu-002',
                name: 'Tesla V100-02',
                model: 'NVIDIA Tesla V100',
                location: 'Site B - Macon, GA',
                status: 'active',
                utilization: 92,
                temperature: 78,
                memory: { used: 15.8, total: 16 },
                power: 280,
                jobs: ['deep-learning-002'],
                lastMaintenance: '2024-01-15',
                nextMaintenance: '2024-03-20', // Due soon
                warranty: { expires: '2025-06-15', status: 'active' },
                purchaseDate: '2023-06-15',
                serialNumber: 'TV100-002-2023',
                firmwareVersion: '1.2.3',
                driverVersion: '535.86.10'
            },
            {
                id: 'gpu-003',
                name: 'A100-01',
                model: 'NVIDIA A100',
                location: 'Site C - Augusta, GA',
                status: 'idle',
                utilization: 0,
                temperature: 45,
                memory: { used: 0, total: 40 },
                power: 50,
                jobs: [],
                lastMaintenance: '2024-02-01',
                nextMaintenance: '2024-05-01',
                warranty: { expires: '2026-03-10', status: 'active' },
                purchaseDate: '2024-03-10',
                serialNumber: 'A100-001-2024',
                firmwareVersion: '2.1.0',
                driverVersion: '535.86.10'
            },
            {
                id: 'gpu-004',
                name: 'A100-02',
                model: 'NVIDIA A100',
                location: 'Site D - Savannah, GA',
                status: 'maintenance',
                utilization: 0,
                temperature: 35,
                memory: { used: 0, total: 40 },
                power: 20,
                jobs: [],
                lastMaintenance: '2024-03-01',
                nextMaintenance: '2024-06-01',
                warranty: { expires: '2026-03-10', status: 'active' },
                purchaseDate: '2024-03-10',
                serialNumber: 'A100-002-2024',
                firmwareVersion: '2.1.0',
                driverVersion: '535.86.10'
            }
        ];

        // Navigation functionality
        function switchSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to corresponding nav button
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
            
            // Load section-specific content
            loadSectionContent(sectionId);
        }

        // Load section-specific content
        function loadSectionContent(sectionId) {
            switch(sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'allocation':
                    loadAllocation();
                    break;
                case 'performance':
                    loadPerformance();
                    break;
                case 'maintenance':
                    loadMaintenance();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        // Create GPU card element
        function createGpuCard(gpu) {
            const card = document.createElement('div');
            card.className = 'gpu-card';
            
            const statusClass = `status-${gpu.status}`;
            const statusText = gpu.status.charAt(0).toUpperCase() + gpu.status.slice(1);
            
            card.innerHTML = `
                <div class="gpu-header">
                    <div class="gpu-name">${gpu.name}</div>
                    <div class="gpu-status ${statusClass}">${statusText}</div>
                </div>
                <div class="gpu-metrics">
                    <div class="metric-row">
                        <span class="metric-label">Model:</span>
                        <span class="metric-value">${gpu.model}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Location:</span>
                        <span class="metric-value">${gpu.location}</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Utilization:</span>
                        <span class="metric-value">${gpu.utilization}%</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Temperature:</span>
                        <span class="metric-value">${gpu.temperature}°C</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Memory:</span>
                        <span class="metric-value">${gpu.memory.used}GB / ${gpu.memory.total}GB</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Power:</span>
                        <span class="metric-value">${gpu.power}W</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Active Jobs:</span>
                        <span class="metric-value">${gpu.jobs.length}</span>
                    </div>
                </div>
                <div class="gpu-actions">
                    <button class="action-btn primary" onclick="viewGpuDetails('${gpu.id}')">Details</button>
                    <button class="action-btn secondary" onclick="manageGpu('${gpu.id}')">Manage</button>
                    ${gpu.status === 'active' ? 
                        `<button class="action-btn danger" onclick="stopGpu('${gpu.id}')">Stop</button>` : 
                        `<button class="action-btn primary" onclick="startGpu('${gpu.id}')">Start</button>`
                    }
                </div>
            `;
            
            return card;
        }

        // Load dashboard content
        function loadDashboard() {
            const solarSitesGrid = document.getElementById('solarSitesGrid');
            if (solarSitesGrid) {
                // Solar sites are now static HTML, no need to populate dynamically
                console.log('Dashboard loaded with solar sites');
            }
        }

        // Load other sections (placeholder implementations)
        function loadInventory() {
            // Solar site inventory is now static HTML - no dynamic loading needed
            console.log('Inventory loaded with solar sites');
        }

        // Create enhanced inventory card
        function createInventoryCard(gpu) {
            const card = document.createElement('div');
            card.className = 'inventory-card';
            
            const statusClass = `status-${gpu.status}`;
            const statusText = gpu.status.charAt(0).toUpperCase() + gpu.status.slice(1);
            
            // Calculate maintenance status
            const today = new Date();
            const nextMaintenance = new Date(gpu.nextMaintenance);
            const daysUntilMaintenance = Math.ceil((nextMaintenance - today) / (1000 * 60 * 60 * 24));
            
            let maintenanceStatus = 'maintenance-value';
            let maintenanceText = `${daysUntilMaintenance} days`;
            
            if (daysUntilMaintenance < 0) {
                maintenanceStatus = 'maintenance-overdue';
                maintenanceText = 'OVERDUE';
            } else if (daysUntilMaintenance <= 7) {
                maintenanceStatus = 'maintenance-due-soon';
                maintenanceText = `${daysUntilMaintenance} days (Due Soon)`;
            }
            
            card.innerHTML = `
                <div class="inventory-header">
                    <div class="inventory-name">${gpu.name}</div>
                    <div class="inventory-status ${statusClass}">${statusText}</div>
                </div>
                
                <div class="inventory-specs">
                    <div class="spec-row">
                        <span class="spec-label">Model:</span>
                        <span class="spec-value">${gpu.model}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Location:</span>
                        <span class="spec-value">${gpu.location}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Serial Number:</span>
                        <span class="spec-value">${gpu.serialNumber}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Purchase Date:</span>
                        <span class="spec-value">${gpu.purchaseDate}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Warranty:</span>
                        <span class="spec-value">${gpu.warranty.status} until ${gpu.warranty.expires}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Firmware:</span>
                        <span class="spec-value">v${gpu.firmwareVersion}</span>
                    </div>
                    <div class="spec-row">
                        <span class="spec-label">Driver:</span>
                        <span class="spec-value">v${gpu.driverVersion}</span>
                    </div>
                </div>
                
                <div class="inventory-maintenance">
                    <div class="maintenance-info">
                        <span class="maintenance-label">Last Maintenance:</span>
                        <span class="maintenance-value">${gpu.lastMaintenance}</span>
                    </div>
                    <div class="maintenance-info">
                        <span class="maintenance-label">Next Maintenance:</span>
                        <span class="${maintenanceStatus}">${maintenanceText}</span>
                    </div>
                </div>
                
                <div class="maintenance-actions">
                    <button class="maintenance-action-btn driver" onclick="createMaintenanceTask('${gpu.id}', 'driver')">
                        🔧 Driver Update
                    </button>
                    <button class="maintenance-action-btn firmware" onclick="createMaintenanceTask('${gpu.id}', 'firmware')">
                        ⚡ Firmware Update
                    </button>
                    <button class="maintenance-action-btn inspection" onclick="createMaintenanceTask('${gpu.id}', 'inspection')">
                        🔍 Inspection
                    </button>
                    <button class="maintenance-action-btn repair" onclick="createMaintenanceTask('${gpu.id}', 'repair')">
                        🛠️ Repair
                    </button>
                    <button class="maintenance-action-btn replace" onclick="createMaintenanceTask('${gpu.id}', 'replace')">
                        🔄 Replace
                    </button>
                </div>
            `;
            
            return card;
        }


        // Create maintenance task from inventory
        function createMaintenanceTask(gpuId, taskType) {
            const gpu = gpuAssets.find(g => g.id === gpuId);
            if (!gpu) return;
            
            // Set default values based on task type
            const taskDefaults = {
                driver: {
                    type: 'driver',
                    description: `Update NVIDIA drivers for ${gpu.name} to latest version`,
                    duration: '30 minutes',
                    priority: 'medium'
                },
                firmware: {
                    type: 'firmware',
                    description: `Update GPU firmware for ${gpu.name} to latest version`,
                    duration: '45 minutes',
                    priority: 'high'
                },
                inspection: {
                    type: 'inspection',
                    description: `Hardware inspection and cleaning for ${gpu.name}`,
                    duration: '2 hours',
                    priority: 'medium'
                },
                repair: {
                    type: 'repair',
                    description: `Repair hardware issues for ${gpu.name}`,
                    duration: '4 hours',
                    priority: 'high'
                },
                replace: {
                    type: 'replace',
                    description: `Replace ${gpu.name} with new unit`,
                    duration: '8 hours',
                    priority: 'critical'
                }
            };
            
            const defaults = taskDefaults[taskType];
            
            // Set form values
            document.getElementById('maintenanceType').value = defaults.type;
            document.getElementById('maintenancePriority').value = defaults.priority;
            document.getElementById('maintenanceDuration').value = defaults.duration;
            document.getElementById('maintenanceDescription').value = defaults.description;
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('maintenanceDate').value = tomorrow.toISOString().split('T')[0];
            
            // Store GPU ID for form submission
            document.getElementById('maintenanceForm').setAttribute('data-gpu-id', gpuId);
            
            // Update modal title
            document.getElementById('maintenanceModalTitle').textContent = `Create ${defaults.type.charAt(0).toUpperCase() + defaults.type.slice(1)} Task - ${gpu.name}`;
            
            // Show modal
            document.getElementById('maintenanceModal').style.display = 'flex';
        }

        // Close maintenance modal
        function closeMaintenanceModal() {
            document.getElementById('maintenanceModal').style.display = 'none';
            document.getElementById('maintenanceForm').reset();
        }

        // Maintenance form submission moved to DOMContentLoaded

        // Add GPU modal functions
        function openAddSiteModal() {
            // Set default values
            const today = new Date();
            document.getElementById('commissionDate').value = today.toISOString().split('T')[0];
            
            // Reset button states
            document.getElementById('testSiteConnectionBtn').disabled = false;
            document.getElementById('testSiteConnectionBtn').textContent = '🔍 Test Connection';
            document.getElementById('addSiteBtn').disabled = true;
            document.getElementById('addSiteBtn').textContent = 'Add Site to Inventory';
            
            // Show modal
            document.getElementById('addSiteModal').style.display = 'flex';
        }

        function closeAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'none';
            document.getElementById('addSiteForm').reset();
        }

        // Test connection function
        function testSiteConnection() {
            const testBtn = document.getElementById('testSiteConnectionBtn');
            const addBtn = document.getElementById('addSiteBtn');
            
            // Validate required fields first
            const requiredFields = ['siteName', 'siteType', 'siteLocation', 'siteCapacity'];
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    alert(`Please fill in the ${fieldId.replace('site', '').replace(/([A-Z])/g, ' $1').toLowerCase()} field before testing connection.`);
                    return;
                }
            }
            
            // Start connection test
            testBtn.disabled = true;
            testBtn.textContent = '🔄 Testing Connection...';
            
            // Simulate 5-second connection test
            setTimeout(() => {
                // Simulate connection success/failure (90% success rate)
                const connectionSuccess = Math.random() > 0.1;
                
                if (connectionSuccess) {
                    testBtn.textContent = '✅ Connection Successful';
                    testBtn.style.backgroundColor = 'var(--status-green)';
                    addBtn.disabled = false;
                    addBtn.style.backgroundColor = 'var(--primary-blue)';
                    
                    // Show success message
                    alert(`Connection test successful!\n\nSite: ${document.getElementById('siteName').value}\nLocation: ${document.getElementById('siteLocation').value}\nGrid Connection: ${document.getElementById('gridConnection').value}\n\nYou can now add this site to inventory.`);
                } else {
                    testBtn.textContent = '❌ Connection Failed';
                    testBtn.style.backgroundColor = 'var(--status-red)';
                    addBtn.disabled = true;
                    
                    // Show failure message
                    alert(`Connection test failed!\n\nPlease check:\n- Connection details are correct\n- GPU is powered on\n- Network connectivity\n- Authentication credentials\n\nTry again after fixing the connection issues.`);
                }
                
                // Re-enable test button after 3 seconds
                setTimeout(() => {
                    testBtn.disabled = false;
                    testBtn.textContent = '🔍 Test Connection';
                    testBtn.style.backgroundColor = '';
                }, 3000);
                
            }, 5000); // 5-second connection test
        }

        // All form submissions and modal event listeners moved to DOMContentLoaded

        // Capacity management data
        const capacityData = {
            sites: [
                {
                    name: 'Site A - Conyers, GA',
                    totalGpus: 6,
                    ondemandGpus: 4,
                    spotGpus: 2,
                    idleGpus: 1,
                    maintenanceGpus: 0
                },
                {
                    name: 'Site B - Macon, GA',
                    totalGpus: 6,
                    ondemandGpus: 5,
                    spotGpus: 1,
                    idleGpus: 0,
                    maintenanceGpus: 0
                },
                {
                    name: 'Site C - Augusta, GA',
                    totalGpus: 6,
                    ondemandGpus: 3,
                    spotGpus: 2,
                    idleGpus: 1,
                    maintenanceGpus: 0
                },
                {
                    name: 'Site D - Savannah, GA',
                    totalGpus: 6,
                    ondemandGpus: 6,
                    spotGpus: 0,
                    idleGpus: 0,
                    maintenanceGpus: 0
                }
            ],
            preemptionEvents: [
                {
                    id: 'preempt-001',
                    type: 'warning',
                    title: 'On-Demand Customer Requesting Capacity',
                    description: 'Customer Alpha needs 2 Tesla V100s at Site A. 1 spot instance will be preempted.',
                    site: 'Site A - Conyers, GA',
                    affectedInstances: 1,
                    timestamp: '2024-03-15 14:30:00'
                },
                {
                    id: 'preempt-002',
                    type: 'critical',
                    title: 'High Priority On-Demand Deployment',
                    description: 'Customer Beta requesting 4 A100s at Site C. All spot instances will be preempted.',
                    site: 'Site C - Augusta, GA',
                    affectedInstances: 2,
                    timestamp: '2024-03-15 15:45:00'
                }
            ],
            scalingAlerts: [
                {
                    id: 'alert-001',
                    type: 'expand',
                    title: 'Site A Capacity Utilization High',
                    description: 'Site A running at 95% capacity. Consider expanding GPU capacity.',
                    priority: 'medium',
                    site: 'Site A - Conyers, GA',
                    utilization: 95
                },
                {
                    id: 'alert-002',
                    type: 'maintain',
                    title: 'Site D Fully Reserved',
                    description: 'Site D has no spot capacity available. Monitor for expansion opportunities.',
                    priority: 'low',
                    site: 'Site D - Savannah, GA',
                    utilization: 100
                },
                {
                    id: 'alert-003',
                    type: 'critical',
                    title: 'Critical Capacity Shortage',
                    description: 'System-wide capacity at 92%. Immediate expansion needed.',
                    priority: 'high',
                    site: 'All Sites',
                    utilization: 92
                }
            ]
        };

        function loadAllocation() {
            loadCapacityAllocation();
            loadPreemptionStatus();
            loadScalingAlerts();
            updateCapacityMetrics();
            initializeCapacityFilters();
        }

        // Load capacity allocation by site
        function loadCapacityAllocation() {
            const capacityContainer = document.getElementById('capacityAllocation');
            capacityContainer.innerHTML = '';

            capacityData.sites.forEach(site => {
                const capacitySite = document.createElement('div');
                capacitySite.className = 'capacity-site';
                
                const ondemandPercent = (site.ondemandGpus / site.totalGpus) * 100;
                const spotPercent = (site.spotGpus / site.totalGpus) * 100;
                const idlePercent = (site.idleGpus / site.totalGpus) * 100;
                const maintenancePercent = (site.maintenanceGpus / site.totalGpus) * 100;
                
                capacitySite.innerHTML = `
                    <div class="site-capacity-info">
                        <div class="site-capacity-name">${site.name}</div>
                        <div class="site-capacity-details">
                            <span>Total: ${site.totalGpus} GPUs</span>
                            <span>On-Demand: ${site.ondemandGpus}</span>
                            <span>Spot Available: ${site.spotGpus}</span>
                            <span>Idle: ${site.idleGpus}</span>
                            <span>Maintenance: ${site.maintenanceGpus}</span>
                        </div>
                    </div>
                    <div class="capacity-bar-container">
                        <div class="capacity-bar">
                            <div class="capacity-segment capacity-ondemand" style="width: ${ondemandPercent}%"></div>
                            <div class="capacity-segment capacity-spot" style="width: ${spotPercent}%"></div>
                            <div class="capacity-segment capacity-idle" style="width: ${idlePercent}%"></div>
                            <div class="capacity-segment capacity-maintenance" style="width: ${maintenancePercent}%"></div>
                        </div>
                        <div class="capacity-labels">
                            <span>On-Demand</span>
                            <span>Spot</span>
                            <span>Idle</span>
                            <span>Maintenance</span>
                        </div>
                    </div>
                `;
                
                capacityContainer.appendChild(capacitySite);
            });
        }

        // Load preemption status
        function loadPreemptionStatus() {
            const preemptionContainer = document.getElementById('preemptionStatus');
            preemptionContainer.innerHTML = '';

            capacityData.preemptionEvents.forEach(event => {
                const preemptionItem = document.createElement('div');
                preemptionItem.className = 'preemption-item';
                
                const iconClass = `preemption-${event.type}`;
                const iconText = event.type === 'critical' ? '!' : event.type === 'warning' ? '⚠' : 'ℹ';
                
                preemptionItem.innerHTML = `
                    <div class="preemption-icon ${iconClass}">${iconText}</div>
                    <div class="preemption-details">
                        <div class="preemption-title">${event.title}</div>
                        <div class="preemption-description">${event.description}</div>
                    </div>
                    <div class="preemption-actions">
                        <button class="preemption-btn acknowledge" onclick="acknowledgePreemption('${event.id}')">Acknowledge</button>
                        <button class="preemption-btn execute" onclick="executePreemption('${event.id}')">Execute</button>
                    </div>
                `;
                
                preemptionContainer.appendChild(preemptionItem);
            });
        }

        // Load scaling alerts
        function loadScalingAlerts() {
            const alertsContainer = document.getElementById('scalingAlerts');
            alertsContainer.innerHTML = '';

            capacityData.scalingAlerts.forEach(alert => {
                const scalingAlert = document.createElement('div');
                scalingAlert.className = 'scaling-alert';
                
                const iconClass = `alert-${alert.type}`;
                const iconText = alert.type === 'critical' ? '!' : alert.type === 'expand' ? '📈' : '⚠';
                
                scalingAlert.innerHTML = `
                    <div class="alert-icon ${iconClass}">${iconText}</div>
                    <div class="alert-details">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-description">${alert.description}</div>
                    </div>
                    <div class="alert-priority priority-${alert.priority}">${alert.priority}</div>
                `;
                
                alertsContainer.appendChild(scalingAlert);
            });
        }

        // Update capacity metrics
        function updateCapacityMetrics() {
            const totalCapacity = capacityData.sites.reduce((sum, site) => sum + site.totalGpus, 0);
            const ondemandCapacity = capacityData.sites.reduce((sum, site) => sum + site.ondemandGpus, 0);
            const spotCapacity = capacityData.sites.reduce((sum, site) => sum + site.spotGpus, 0);
            const capacityHealth = Math.round((ondemandCapacity / totalCapacity) * 100);
            
            document.getElementById('totalCapacity').textContent = totalCapacity;
            document.getElementById('ondemandCapacity').textContent = ondemandCapacity;
            document.getElementById('spotCapacity').textContent = spotCapacity;
            document.getElementById('capacityHealth').textContent = capacityHealth + '%';
        }

        // Initialize capacity filters
        function initializeCapacityFilters() {
            document.querySelectorAll('[data-view]').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('[data-view]').forEach(b => b.classList.remove('active'));
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Filter capacity view
                    const view = this.getAttribute('data-view');
                    filterCapacityView(view);
                });
            });
        }

        // Filter capacity view
        function filterCapacityView(view) {
            // This would filter the capacity display based on the selected view
            // For now, just reload the full view
            loadCapacityAllocation();
        }

        // Preemption management functions
        function acknowledgePreemption(eventId) {
            const event = capacityData.preemptionEvents.find(e => e.id === eventId);
            if (event) {
                alert(`Preemption event "${event.title}" acknowledged`);
                // In a real system, this would update the event status
            }
        }

        function executePreemption(eventId) {
            const event = capacityData.preemptionEvents.find(e => e.id === eventId);
            if (event && confirm(`Execute preemption for "${event.title}"?`)) {
                alert(`Preemption executed: ${event.affectedInstances} spot instances will be terminated`);
                // In a real system, this would trigger the preemption process
                loadCapacityAllocation();
                updateCapacityMetrics();
            }
        }

        function loadPerformance() {
            // Generate initial cached data
            generateAndCacheSiteData();
            
            // Initialize Site selector
            initializeSiteSelector();
            
            // Initialize charts after ensuring DOM is ready
            setTimeout(() => {
                try {
                    if (typeof Chart !== 'undefined') {
                        initializeCharts();
                        setupChartTimeControls();
                        // Load charts with initial data
                        updatePerformanceCharts('all');
                    } else {
                        console.log('Chart.js not available, skipping chart initialization');
                    }
                } catch (error) {
                    console.error('Error during chart setup:', error);
                }
            }, 1000);
            
            // Simulate real-time data updates
            startPerformanceUpdates();
            
            // Initialize alert system
            initializeAlerts();
        }

        // Initialize Site selector dropdown
        function initializeSiteSelector() {
            const siteSelector = document.getElementById('siteSelector');
            
            // Add change event listener
            siteSelector.addEventListener('change', function() {
                updatePerformanceDisplay(this.value);
                updatePerformanceCharts(this.value);
            });
            
            // Initialize with "All Sites" view
            updatePerformanceDisplay('all');
            updatePerformanceCharts('all');
        }

        // Update performance display based on selected Site
        function updatePerformanceDisplay(selectedSiteId) {
            if (selectedSiteId === 'all') {
                // Show average metrics from both sites
                updateAverageMetrics();
                updateChartTitles('All Sites (Average)');
            } else {
                // Show individual Site metrics using cached data
                const selectedSite = getCachedSiteData(selectedSiteId);
                if (selectedSite) {
                    updateIndividualSiteMetrics(selectedSite);
                    updateChartTitles(selectedSite.name);
                }
            }
        }

        // Update average metrics display
        function updateAverageMetrics() {
            // Get cached data for both solar sites (same values used consistently)
            const cummins = getCachedSiteData('cummins-midrand');
            const fnb = getCachedSiteData('fnb-willowbridge');
            
            if (cummins && fnb) {
                // Calculate averages from both sites for chart data
                const avgUtil = Math.round((cummins.utilization + fnb.utilization) / 2);
                const avgTemp = Math.round((cummins.temperature + fnb.temperature) / 2);
                const avgPower = Math.round((cummins.power + fnb.power) / 2);
                const avgEfficiency = Math.round((cummins.efficiency + fnb.efficiency) / 2);
                
                // Return the calculated averages for chart use
                return { avgUtil, avgTemp, avgPower, avgEfficiency };
            }
        }

        // Get site data by ID
        function getSiteData(siteId) {
            const sites = {
                'cummins-midrand': {
                    name: 'Cummins Midrand',
                    utilization: 0,      // 0% (no sun currently)
                    temperature: 25,     // 25°C ambient
                    power: 0,           // 0 kW (no production)
                    efficiency: 0,      // 0% efficiency (nighttime)
                    capacity: 821.88    // Total capacity in kW
                },
                'fnb-willowbridge': {
                    name: 'FNB Willowbridge',
                    utilization: 0,      // 0% (no sun currently)
                    temperature: 24,     // 24°C ambient
                    power: 0,           // 0 kW (no production)
                    efficiency: 0,      // 0% efficiency (nighttime)
                    capacity: 51.98     // Total capacity in kW
                }
            };
            return sites[siteId];
        }

        // Simulate dynamic site data (optional - adds realistic variation)
        function getRealtimeSiteData(siteId) {
            const baseData = getSiteData(siteId);
            const currentHour = new Date().getHours();
            
            // Simulate solar production based on time of day (6 AM to 6 PM peak)
            let solarFactor = 0;
            if (currentHour >= 6 && currentHour <= 18) {
                // Peak solar hours: 11 AM - 3 PM
                if (currentHour >= 11 && currentHour <= 15) {
                    solarFactor = 0.8 + (Math.random() * 0.2); // 80-100%
                } else if (currentHour >= 8 && currentHour <= 17) {
                    solarFactor = 0.4 + (Math.random() * 0.4); // 40-80%
                } else {
                    solarFactor = 0.1 + (Math.random() * 0.3); // 10-40%
                }
            }
            
            return {
                ...baseData,
                utilization: Math.round(solarFactor * 100),
                power: Math.round(baseData.capacity * solarFactor),
                efficiency: Math.round(solarFactor * 100),
                temperature: baseData.temperature + Math.round(solarFactor * 15) // Panels heat up in sun
            };
        }

        // Update individual Site metrics display
        function updateIndividualSiteMetrics(site) {
            // Performance metrics are now displayed in the site cards, not separate elements
            // This function is kept for compatibility but doesn't update non-existent DOM elements
            console.log('Individual site metrics updated for:', site.name);
            
            // Update trend indicators based on individual Site status
            updateTrendIndicators(site);
        }

        // Update trend indicators for individual GPU
        function updateTrendIndicators(gpu) {
            const utilizationTrend = document.getElementById('utilizationTrend');
            const temperatureTrend = document.getElementById('temperatureTrend');
            const powerTrend = document.getElementById('powerTrend');
            const memoryTrend = document.getElementById('memoryTrend');
            
            // Utilization trend
            if (gpu.utilization > 80) {
                utilizationTrend.textContent = '↗ High utilization';
                utilizationTrend.className = 'performance-trend trend-up';
            } else if (gpu.utilization < 20) {
                utilizationTrend.textContent = '↘ Low utilization';
                utilizationTrend.className = 'performance-trend trend-down';
            } else {
                utilizationTrend.textContent = '→ Normal utilization';
                utilizationTrend.className = 'performance-trend trend-stable';
            }
            
            // Temperature trend
            if (gpu.temperature > 75) {
                temperatureTrend.textContent = '↗ High temperature';
                temperatureTrend.className = 'performance-trend trend-up';
            } else if (gpu.temperature < 50) {
                temperatureTrend.textContent = '↘ Low temperature';
                temperatureTrend.className = 'performance-trend trend-down';
            } else {
                temperatureTrend.textContent = '→ Normal temperature';
                temperatureTrend.className = 'performance-trend trend-stable';
            }
            
            // Power trend
            if (gpu.power > 200) {
                powerTrend.textContent = '↗ High power draw';
                powerTrend.className = 'performance-trend trend-up';
            } else if (gpu.power < 100) {
                powerTrend.textContent = '↘ Low power draw';
                powerTrend.className = 'performance-trend trend-down';
            } else {
                powerTrend.textContent = '→ Normal power draw';
                powerTrend.className = 'performance-trend trend-stable';
            }
            
            // Memory trend
            const memoryPercent = Math.round((gpu.memory.used / gpu.memory.total) * 100);
            if (memoryPercent > 80) {
                memoryTrend.textContent = '↗ High memory usage';
                memoryTrend.className = 'performance-trend trend-up';
            } else if (memoryPercent < 20) {
                memoryTrend.textContent = '↘ Low memory usage';
                memoryTrend.className = 'performance-trend trend-down';
            } else {
                memoryTrend.textContent = '→ Normal memory usage';
                memoryTrend.className = 'performance-trend trend-stable';
            }
        }

        // Update chart titles
        function updateChartTitles(siteName) {
            // Chart titles are now handled by the chart instances themselves
            console.log('Chart titles updated for:', siteName);
        }

        // Update performance charts based on selected site
        function updatePerformanceCharts(selectedSiteId) {
            try {
                console.log('Updating charts for:', selectedSiteId);
                
                // Skip if charts aren't initialized yet
                if (!utilizationChartInstance && !temperatureChartInstance && !powerChartInstance) {
                    console.log('Charts not initialized yet, skipping update');
                    return;
                }
                
                // Get current time periods for each chart
                const utilizationPeriod = document.querySelector('#utilizationChart')?.closest('.chart-container')?.querySelector('.chart-btn.active')?.getAttribute('data-period') || '24h';
                const temperaturePeriod = document.querySelector('#temperatureChart')?.closest('.chart-container')?.querySelector('.chart-btn.active')?.getAttribute('data-period') || '1h';
                const powerPeriod = document.querySelector('#powerChart')?.closest('.chart-container')?.querySelector('.chart-btn.active')?.getAttribute('data-period') || '1h';
                
                // Update each chart with new site data
                if (utilizationChartInstance) {
                    const utilizationData = generateChartData(selectedSiteId, utilizationPeriod, 'utilization');
                    updateChart(utilizationChartInstance, utilizationData.labels, utilizationData.data, selectedSiteId, utilizationPeriod, 'utilization');
                }
                
                if (temperatureChartInstance) {
                    const temperatureData = generateChartData(selectedSiteId, temperaturePeriod, 'temperature');
                    updateChart(temperatureChartInstance, temperatureData.labels, temperatureData.data, selectedSiteId, temperaturePeriod, 'temperature');
                }
                
                if (powerChartInstance) {
                    const powerData = generateChartData(selectedSiteId, powerPeriod, 'power');
                    updateChart(powerChartInstance, powerData.labels, powerData.data, selectedSiteId, powerPeriod, 'power');
                }
            } catch (error) {
                console.error('Error updating charts:', error);
            }
        }

        // Generate chart data for average of all sites
        function generateAverageChartData() {
            const cumminsData = generateSiteChartData('cummins-midrand');
            const fnbData = generateSiteChartData('fnb-willowbridge');
            
            // Calculate averages for each time point
            const averageData = cumminsData.map((cumminsVal, index) => {
                return Math.round((cumminsVal + fnbData[index]) / 2);
            });
            
            return averageData;
        }

        // Generate realistic chart data for a specific site
        function generateSiteChartData(siteId) {
            const currentHour = new Date().getHours();
            const site = getSiteData(siteId);
            
            // Generate 24 hours of data (hourly intervals)
            const hourlyData = [];
            for (let hour = 0; hour < 24; hour++) {
                let utilization = 0;
                
                // Solar production curve (6 AM to 6 PM)
                if (hour >= 6 && hour <= 18) {
                    // Peak solar hours: 11 AM - 3 PM
                    if (hour >= 11 && hour <= 15) {
                        utilization = 80 + Math.random() * 20; // 80-100%
                    } else if (hour >= 8 && hour <= 17) {
                        utilization = 40 + Math.random() * 40; // 40-80%
                    } else {
                        utilization = 10 + Math.random() * 30; // 10-40%
                    }
                }
                
                // Adjust based on site capacity (Cummins is larger, more stable)
                if (siteId === 'cummins-midrand') {
                    utilization *= 1.1; // Slightly higher efficiency
                } else {
                    utilization *= 0.95; // Slightly lower for smaller site
                }
                
                hourlyData.push(Math.min(100, Math.max(0, Math.round(utilization))));
            }
            
            return hourlyData;
        }

        // Chart instances
        let utilizationChartInstance = null;
        let temperatureChartInstance = null;
        let powerChartInstance = null;


        // Initialize all charts
        function initializeCharts() {
            try {
                initializeUtilizationChart();
                initializeTemperatureChart();
                initializePowerChart();
                console.log('Charts initialized successfully');
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        }

        // Initialize utilization chart
        function initializeUtilizationChart() {
            const ctx = document.getElementById('utilizationChartCanvas');
            if (!ctx) {
                console.log('Utilization chart canvas not found');
                return;
            }

            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                return;
            }

            if (utilizationChartInstance) {
                utilizationChartInstance.destroy();
            }

            try {
                // Get initial data for the chart
            const initialData = generateChartData('all', '24h', 'utilization');
            
            utilizationChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: initialData.labels,
                    datasets: [{
                        label: 'Utilization %',
                        data: initialData.data,
                        borderColor: '#455BF1',
                        backgroundColor: 'rgba(69, 91, 241, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#455BF1',
                        pointBorderColor: '#455BF1',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: true,
                                color: '#e0e0e0'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
            } catch (error) {
                console.error('Error creating utilization chart:', error);
            }
        }

        // Initialize temperature chart
        function initializeTemperatureChart() {
            const ctx = document.getElementById('temperatureChartCanvas');
            if (!ctx) return;

            if (temperatureChartInstance) {
                temperatureChartInstance.destroy();
            }

            // Get initial data for the chart
            const initialTempData = generateChartData('all', '1h', 'temperature');
            
            temperatureChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: initialTempData.labels,
                    datasets: [{
                        label: 'Temperature °C',
                        data: initialTempData.data,
                        borderColor: '#22C55E',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#22C55E',
                        pointBorderColor: '#22C55E',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 15,
                            max: 45,
                            ticks: {
                                callback: function(value) {
                                    return value + '°C';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: true,
                                color: '#e0e0e0'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Initialize power chart
        function initializePowerChart() {
            const ctx = document.getElementById('powerChartCanvas');
            if (!ctx) return;

            if (powerChartInstance) {
                powerChartInstance.destroy();
            }

            // Get initial data for the chart
            const initialPowerData = generateChartData('all', '1h', 'power');
            
            powerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: initialPowerData.labels,
                    datasets: [{
                        label: 'Power kW',
                        data: initialPowerData.data,
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#F59E0B',
                        pointBorderColor: '#F59E0B',
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + ' kW';
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: true,
                                color: '#e0e0e0'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Generate chart data based on time period and site using cached values
        function generateChartData(siteId, period, type) {
            let labels, dataPoints;
            
            // Generate labels based on period
            switch (period) {
                case '1h':
                    labels = ['0m', '10m', '20m', '30m', '40m', '50m'];
                    dataPoints = 6;
                    break;
                case '6h':
                    labels = ['0h', '1h', '2h', '3h', '4h', '5h'];
                    dataPoints = 6;
                    break;
                case '24h':
                    labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'];
                    dataPoints = 6;
                    break;
                case '7d':
                    labels = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6'];
                    dataPoints = 6;
                    break;
                default:
                    labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'];
                    dataPoints = 6;
            }

            // Get current cached values for the site(s)
            let currentValue = 0;
            if (siteId === 'all') {
                // For averages, use the same values shown in performance cards
                const cummins = getCachedSiteData('cummins-midrand');
                const fnb = getCachedSiteData('fnb-willowbridge');
                if (cummins && fnb) {
                    if (type === 'utilization') {
                        currentValue = Math.round((cummins.utilization + fnb.utilization) / 2);
                    } else if (type === 'temperature') {
                        currentValue = Math.round((cummins.temperature + fnb.temperature) / 2);
                    } else if (type === 'power') {
                        currentValue = Math.round((cummins.power + fnb.power) / 2);
                    }
                }
            } else {
                // For individual sites, use exact cached values
                const siteData = getCachedSiteData(siteId);
                if (siteData) {
                    if (type === 'utilization') {
                        currentValue = siteData.utilization;
                    } else if (type === 'temperature') {
                        currentValue = siteData.temperature;
                    } else if (type === 'power') {
                        currentValue = siteData.power;
                    }
                }
            }

            // Generate time series that shows variation around the current value
            const data = [];
            for (let i = 0; i < dataPoints; i++) {
                let value = currentValue;
                
                // Add realistic time-based variation based on period
                if (period === '24h') {
                    // Solar pattern over 24 hours
                    if (type === 'utilization' || type === 'power') {
                        if (i === 0 || i === 5) value = 0; // Night hours
                        else if (i === 1) value = currentValue * 0.2; // Dawn
                        else if (i === 4) value = currentValue * 0.6; // Dusk
                        else if (i === 3) value = currentValue * 1.1; // Peak noon
                        // i === 2 uses currentValue (morning)
                    } else if (type === 'temperature') {
                        if (i === 0 || i === 5) value = currentValue - 8; // Cooler at night
                        else if (i === 3) value = currentValue + 5; // Hottest at noon
                    }
                } else {
                    // For other periods, add small variation around current value
                    const variation = currentValue * 0.1; // ±10% variation
                    value = currentValue + (Math.random() - 0.5) * variation;
                }
                
                data.push(Math.max(0, Math.round(value * 100) / 100));
            }
            
            return { labels, data };
        }

        // Update chart with new data
        function updateChart(chartInstance, labels, data, siteId, period, type) {
            if (!chartInstance) return;
            
            chartInstance.data.labels = labels;
            chartInstance.data.datasets[0].data = data;
            
            // Update dataset label based on site
            if (siteId === 'all') {
                chartInstance.data.datasets[0].label = `Average ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            } else {
                const siteName = siteId === 'cummins-midrand' ? 'Cummins Midrand' : 'FNB Willowbridge';
                chartInstance.data.datasets[0].label = `${siteName} ${type.charAt(0).toUpperCase() + type.slice(1)}`;
            }
            
            chartInstance.update('active');
        }

        // Handle time period button clicks
        function setupChartTimeControls() {
            console.log('Setting up chart time controls...');
            const chartButtons = document.querySelectorAll('.chart-btn[data-period]');
            console.log('Found chart buttons:', chartButtons.length);
            
            chartButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Chart button clicked:', this.getAttribute('data-period'));
                    
                    const period = this.getAttribute('data-period');
                    const chartContainer = this.closest('.chart-container');
                    
                    // Update active button
                    chartContainer.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Get current selected site
                    const selectedSiteId = document.getElementById('siteSelector').value;
                    
                    // Update the specific chart
                    updateChartsForPeriod(chartContainer, period, selectedSiteId);
                });
            });
        }

        // Update charts for specific period
        function updateChartsForPeriod(chartContainer, period, siteId) {
            const chartCanvas = chartContainer.querySelector('canvas');
            const chartId = chartCanvas.id;
            
            let chartType, chartInstance;
            if (chartId === 'utilizationChartCanvas') {
                chartType = 'utilization';
                chartInstance = utilizationChartInstance;
            } else if (chartId === 'temperatureChartCanvas') {
                chartType = 'temperature';
                chartInstance = temperatureChartInstance;
            } else if (chartId === 'powerChartCanvas') {
                chartType = 'power';
                chartInstance = powerChartInstance;
            }
            
            if (chartInstance && chartType) {
                const chartData = generateChartData(siteId, period, chartType);
                updateChart(chartInstance, chartData.labels, chartData.data, siteId, period, chartType);
            }
        }

        // Refresh Site data
        function refreshSiteData() {
            // Force regeneration of cached data
            generateAndCacheSiteData();
            
            const selectedSiteId = document.getElementById('siteSelector').value;
            updatePerformanceDisplay(selectedSiteId);
            updatePerformanceCharts(selectedSiteId);
            
            // Simulate data refresh
            const refreshBtn = document.querySelector('[onclick="refreshSiteData()"]');
            const originalText = refreshBtn.textContent;
            refreshBtn.textContent = '🔄 Refreshing...';
            refreshBtn.disabled = true;
            
            setTimeout(() => {
                refreshBtn.textContent = originalText;
                refreshBtn.disabled = false;
                alert('GPU data refreshed successfully!');
            }, 1500);
        }

        // Initialize chart controls
        function initializeChartControls() {
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons in the same chart
                    const chartContainer = this.closest('.chart-container');
                    chartContainer.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update chart data based on selected period
                    const period = this.getAttribute('data-period');
                    updateChartData(this.closest('.chart-container').querySelector('.chart-canvas'), period);
                });
            });
        }

        // Update chart data (simulated)
        function updateChartData(chartCanvas, period) {
            const placeholder = chartCanvas.querySelector('.chart-placeholder');
            if (placeholder) {
                placeholder.textContent = `📊 Loading ${period} data...`;
                
                // Simulate data loading
                setTimeout(() => {
                    placeholder.textContent = `📊 ${period} Chart Data Loaded`;
                }, 1000);
            }
        }

        // Start performance updates simulation
        function startPerformanceUpdates() {
            setInterval(() => {
                updatePerformanceMetrics();
            }, 5000); // Update every 5 seconds
        }

        // Update performance metrics (now handles both individual and average views)
        function updatePerformanceMetrics() {
            const selectedSiteId = document.getElementById('siteSelector').value;
            
            if (selectedSiteId === 'all') {
                // Update average metrics
                updateAverageMetrics();
            } else {
                // Update individual site metrics
                const selectedSite = siteAssets.find(site => site.id === selectedSiteId);
                if (selectedSite) {
                    updateIndividualSiteMetrics(selectedSite);
                }
            }
        }
        
        // Initialize Chart.js charts
        function initializeCharts() {
            try {
                initializeUtilizationChart();
                initializeTemperatureChart();
                initializePowerChart();
                console.log('Charts initialized successfully');
            } catch (error) {
                console.error('Error initializing charts:', error);
            }
        }
        
        // Initialize utilization chart
        function initializeUtilizationChart() {
            const canvas = document.getElementById('utilizationChartCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            utilizationChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Utilization (%)',
                        data: [],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }
        
        // Initialize temperature chart
        function initializeTemperatureChart() {
            const canvas = document.getElementById('temperatureChartCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            temperatureChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: [],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Initialize power chart
        function initializePowerChart() {
            const canvas = document.getElementById('powerChartCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            powerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Power Output (kW)',
                        data: [],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Setup chart time controls
        function setupChartTimeControls() {
            const chartButtons = document.querySelectorAll('.chart-btn');
            
            chartButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Chart button clicked:', this.getAttribute('data-period'));
                    
                    // Remove active class from all buttons in the same chart
                    const chartContainer = this.closest('.chart-container');
                    chartContainer.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Update charts with new time period
                    const period = this.getAttribute('data-period');
                    const selectedSiteId = document.getElementById('siteSelector').value;
                    updateChartsForPeriod(selectedSiteId, period);
                });
            });
        }
        
        // Update charts for specific time period
        function updateChartsForPeriod(siteId, period) {
            console.log('Updating charts for period:', period, 'site:', siteId);
            
            // Generate chart data for the specified period
            const utilizationData = generateChartData(siteId, period, 'utilization');
            const temperatureData = generateChartData(siteId, period, 'temperature');
            const powerData = generateChartData(siteId, period, 'power');
            
            // Update each chart
            updateChart(utilizationChartInstance, utilizationData.labels, utilizationData.data, siteId, period, 'utilization');
            updateChart(temperatureChartInstance, temperatureData.labels, temperatureData.data, siteId, period, 'temperature');
            updateChart(powerChartInstance, powerData.labels, powerData.data, siteId, period, 'power');
        }
        
        // Generate chart data for specific period and metric
        function generateChartData(siteId, period, metricType) {
            const now = new Date();
            let labels = [];
            let data = [];
            
            // Generate time labels based on period
            switch (period) {
                case '1h':
                    for (let i = 11; i >= 0; i--) {
                        const time = new Date(now.getTime() - i * 5 * 60000); // 5-minute intervals
                        labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                        data.push(Math.floor(Math.random() * 100));
                    }
                    break;
                case '6h':
                    for (let i = 11; i >= 0; i--) {
                        const time = new Date(now.getTime() - i * 30 * 60000); // 30-minute intervals
                        labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                        data.push(Math.floor(Math.random() * 100));
                    }
                    break;
                case '24h':
                    for (let i = 23; i >= 0; i--) {
                        const time = new Date(now.getTime() - i * 60 * 60000); // 1-hour intervals
                        labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit' }));
                        data.push(Math.floor(Math.random() * 100));
                    }
                    break;
                case '7d':
                    for (let i = 6; i >= 0; i--) {
                        const time = new Date(now.getTime() - i * 24 * 60 * 60000); // Daily intervals
                        labels.push(time.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                        data.push(Math.floor(Math.random() * 100));
                    }
                    break;
            }
            
            return { labels, data };
        }
        
        // Update individual chart
        function updateChart(chartInstance, labels, data, siteId, period, chartType) {
            if (!chartInstance) return;
            
            chartInstance.data.labels = labels;
            chartInstance.data.datasets[0].data = data;
            chartInstance.update();
        }
        
        // Update performance charts based on selected site
        function updatePerformanceCharts(selectedSiteId) {
            try {
                console.log('Updating charts for:', selectedSiteId);
                
                // Skip if charts aren't initialized yet
                if (!utilizationChartInstance && !temperatureChartInstance && !powerChartInstance) {
                    console.log('Charts not initialized yet, skipping update');
                    return;
                }
                
                // Get current time periods for each chart
                const utilizationPeriod = document.querySelector('#utilizationChartCanvas').closest('.chart-container').querySelector('.chart-btn.active')?.getAttribute('data-period') || '1h';
                const temperaturePeriod = document.querySelector('#temperatureChartCanvas').closest('.chart-container').querySelector('.chart-btn.active')?.getAttribute('data-period') || '1h';
                const powerPeriod = document.querySelector('#powerChartCanvas').closest('.chart-container').querySelector('.chart-btn.active')?.getAttribute('data-period') || '1h';
                
                // Update each chart with its current time period
                updateChartsForPeriod(selectedSiteId, utilizationPeriod);
                updateChartsForPeriod(selectedSiteId, temperaturePeriod);
                updateChartsForPeriod(selectedSiteId, powerPeriod);
            } catch (error) {
                console.error('Error updating performance charts:', error);
            }
        }

        // Initialize alerts system
        function initializeAlerts() {
            // Check for new alerts periodically
            setInterval(() => {
                checkForNewAlerts();
            }, 10000); // Check every 10 seconds
        }

        // Check for new alerts (simulated)
        function checkForNewAlerts() {
            // Simulate random alerts
            if (Math.random() < 0.1) { // 10% chance of new alert
                const alertTypes = [
                    { type: 'warning', message: 'Low Solar Irradiance', icon: '⚠' },
                    { type: 'info', message: 'Inverter Efficiency Drop', icon: 'ℹ' },
                    { type: 'critical', message: 'Grid Connection Issue', icon: '!' },
                    { type: 'warning', message: 'Panel Cleaning Required', icon: '⚠' },
                    { type: 'info', message: 'Performance Report Available', icon: 'ℹ' }
                ];
                
                const randomAlert = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                addNewAlert(randomAlert.type, randomAlert.message, randomAlert.icon);
            }
        }

        // Add new alert to the alerts section
        function addNewAlert(type, message, icon) {
            const alertsSection = document.querySelector('.alerts-section');
            if (!alertsSection) return;
            
            const alertList = alertsSection.querySelector('.alert-item').parentNode;
            const newAlert = document.createElement('div');
            newAlert.className = 'alert-item';
            newAlert.innerHTML = `
                <div class="alert-icon ${type}">${icon}</div>
                <div class="alert-content">
                    <div class="alert-title">${message} - ${Math.random() < 0.5 ? 'Cummins Midrand' : 'FNB Willowbridge'}</div>
                    <div class="alert-time">Just now</div>
                </div>
                <div class="alert-actions">
                    <button class="alert-btn acknowledge" onclick="acknowledgeAlert('${Date.now()}')">Acknowledge</button>
                    <button class="alert-btn resolve" onclick="resolveAlert('${Date.now()}')">Resolve</button>
                </div>
            `;
            
            // Insert at the top
            alertList.insertBefore(newAlert, alertList.firstChild);
            
            // Remove after 30 seconds if not acknowledged
            setTimeout(() => {
                if (newAlert.parentNode) {
                    newAlert.remove();
                }
            }, 30000);
        }

        // Alert management functions
        function acknowledgeAlert(alertId) {
            alert(`Alert ${alertId} acknowledged`);
            // In a real implementation, this would update the alert status in the backend
        }

        function resolveAlert(alertId) {
            alert(`Alert ${alertId} resolved`);
            // In a real implementation, this would mark the alert as resolved
        }

        // Sample maintenance data
        const maintenanceTasks = [
            {
                id: 'maint-001',
                title: 'Tesla V100-01 Driver Update',
                gpu: 'Tesla V100-01',
                type: 'Driver Update',
                status: 'scheduled',
                scheduledDate: '2024-03-15',
                estimatedDuration: '30 minutes',
                priority: 'Medium',
                description: 'Update NVIDIA drivers to version 535.86.10'
            },
            {
                id: 'maint-002',
                title: 'A100-02 Hardware Inspection',
                gpu: 'A100-02',
                type: 'Hardware Inspection',
                status: 'completed',
                scheduledDate: '2024-03-10',
                estimatedDuration: '2 hours',
                priority: 'High',
                description: 'Quarterly hardware inspection and cleaning'
            },
            {
                id: 'maint-003',
                title: 'Tesla V100-02 Firmware Update',
                gpu: 'Tesla V100-02',
                type: 'Firmware Update',
                status: 'failed',
                scheduledDate: '2024-03-12',
                estimatedDuration: '45 minutes',
                priority: 'High',
                description: 'Update GPU firmware to latest version'
            }
        ];

        // Sample driver data
        const driverInfo = [
            {
                name: 'NVIDIA Tesla V100 Driver',
                currentVersion: '535.86.10',
                latestVersion: '535.86.10',
                status: 'up-to-date',
                gpus: ['Tesla V100-01', 'Tesla V100-02']
            },
            {
                name: 'NVIDIA A100 Driver',
                currentVersion: '535.86.10',
                latestVersion: '535.86.10',
                status: 'up-to-date',
                gpus: ['A100-01', 'A100-02']
            }
        ];

        // Sample maintenance history
        const maintenanceHistory = [
            {
                date: '2024-03-10',
                gpu: 'A100-02',
                action: 'Hardware Inspection',
                status: 'Completed',
                duration: '2h 15m',
                technician: 'John Smith'
            },
            {
                date: '2024-03-08',
                gpu: 'Tesla V100-01',
                action: 'Driver Update',
                status: 'Completed',
                duration: '25m',
                technician: 'Sarah Johnson'
            },
            {
                date: '2024-03-05',
                gpu: 'Tesla V100-02',
                action: 'Firmware Update',
                status: 'Failed',
                duration: '15m',
                technician: 'Mike Davis'
            },
            {
                date: '2024-02-28',
                gpu: 'A100-01',
                action: 'Cleaning & Maintenance',
                status: 'Completed',
                duration: '1h 30m',
                technician: 'John Smith'
            }
        ];

        function loadMaintenance() {
            loadMaintenanceTasks();
            loadDriverManagement();
            loadMaintenanceHistory();
        }

        // Load maintenance tasks
        function loadMaintenanceTasks() {
            const maintenanceGrid = document.getElementById('maintenanceGrid');
            maintenanceGrid.innerHTML = '';

            maintenanceTasks.forEach(task => {
                const taskCard = createMaintenanceCard(task);
                maintenanceGrid.appendChild(taskCard);
            });
        }

        // Create maintenance card
        function createMaintenanceCard(task) {
            const card = document.createElement('div');
            card.className = 'maintenance-card';
            
            const statusClass = `status-${task.status}`;
            const statusText = task.status.charAt(0).toUpperCase() + task.status.slice(1);
            
            card.innerHTML = `
                <div class="maintenance-header">
                    <div class="maintenance-title">${task.title}</div>
                    <div class="maintenance-status ${statusClass}">${statusText}</div>
                </div>
                <div class="maintenance-details">
                    <div class="detail-row">
                        <span class="detail-label">GPU:</span>
                        <span class="detail-value">${task.gpu}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Type:</span>
                        <span class="detail-value">${task.type}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Scheduled:</span>
                        <span class="detail-value">${task.scheduledDate}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Duration:</span>
                        <span class="detail-value">${task.estimatedDuration}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Priority:</span>
                        <span class="detail-value">${task.priority}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Description:</span>
                        <span class="detail-value">${task.description}</span>
                    </div>
                </div>
                <div class="maintenance-actions">
                    ${task.status === 'scheduled' ? 
                        `<button class="maintenance-btn primary" onclick="startMaintenance('${task.id}')">Start</button>
                         <button class="maintenance-btn secondary" onclick="rescheduleMaintenance('${task.id}')">Reschedule</button>` :
                        task.status === 'completed' ?
                        `<button class="maintenance-btn secondary" onclick="viewMaintenanceDetails('${task.id}')">View Details</button>` :
                        `<button class="maintenance-btn primary" onclick="retryMaintenance('${task.id}')">Retry</button>
                         <button class="maintenance-btn danger" onclick="cancelMaintenance('${task.id}')">Cancel</button>`
                    }
                </div>
            `;
            
            return card;
        }

        // Load driver management
        function loadDriverManagement() {
            const driverGrid = document.getElementById('driverGrid');
            driverGrid.innerHTML = '';

            driverInfo.forEach(driver => {
                const driverCard = createDriverCard(driver);
                driverGrid.appendChild(driverCard);
            });
        }

        // Create driver card
        function createDriverCard(driver) {
            const card = document.createElement('div');
            card.className = 'driver-card';
            
            card.innerHTML = `
                <div class="driver-name">${driver.name}</div>
                <div class="driver-version">Current: ${driver.currentVersion} | Latest: ${driver.latestVersion}</div>
                <div class="driver-status">
                    <span>Status: <strong>${driver.status}</strong></span>
                    <span>GPUs: ${driver.gpus.length}</span>
                </div>
                <div class="driver-actions">
                    <button class="driver-btn update" onclick="updateDriver('${driver.name}')">Update</button>
                    <button class="driver-btn rollback" onclick="rollbackDriver('${driver.name}')">Rollback</button>
                </div>
            `;
            
            return card;
        }

        // Load maintenance history
        function loadMaintenanceHistory() {
            const historyContainer = document.getElementById('maintenanceHistory');
            historyContainer.innerHTML = '';

            const historyTable = document.createElement('table');
            historyTable.style.width = '100%';
            historyTable.style.borderCollapse = 'collapse';
            historyTable.innerHTML = `
                <thead>
                    <tr style="background-color: var(--neutral-light);">
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">Date</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">GPU</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">Action</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">Status</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">Duration</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border-grey);">Technician</th>
                    </tr>
                </thead>
                <tbody>
                    ${maintenanceHistory.map(entry => `
                        <tr>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">${entry.date}</td>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">${entry.gpu}</td>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">${entry.action}</td>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">
                                <span style="color: ${entry.status === 'Completed' ? 'var(--status-green)' : 'var(--status-red)'};">
                                    ${entry.status}
                                </span>
                            </td>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">${entry.duration}</td>
                            <td style="padding: 12px; border-bottom: 1px solid var(--border-grey);">${entry.technician}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
            
            historyContainer.appendChild(historyTable);
        }

        // Maintenance management functions
        function startMaintenance(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'in-progress';
                loadMaintenanceTasks();
                alert(`Starting maintenance: ${task.title}`);
            }
        }

        function rescheduleMaintenance(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (task) {
                const newDate = prompt('Enter new date (YYYY-MM-DD):', task.scheduledDate);
                if (newDate) {
                    task.scheduledDate = newDate;
                    loadMaintenanceTasks();
                    alert(`Maintenance rescheduled to: ${newDate}`);
                }
            }
        }

        function viewMaintenanceDetails(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (task) {
                alert(`Maintenance Details:\n\nTask: ${task.title}\nGPU: ${task.gpu}\nType: ${task.type}\nStatus: ${task.status}\nScheduled: ${task.scheduledDate}\nDuration: ${task.estimatedDuration}\nPriority: ${task.priority}\nDescription: ${task.description}`);
            }
        }

        function retryMaintenance(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'scheduled';
                loadMaintenanceTasks();
                alert(`Maintenance retry scheduled: ${task.title}`);
            }
        }

        function cancelMaintenance(taskId) {
            const task = maintenanceTasks.find(t => t.id === taskId);
            if (task && confirm(`Cancel maintenance: ${task.title}?`)) {
                const index = maintenanceTasks.findIndex(t => t.id === taskId);
                maintenanceTasks.splice(index, 1);
                loadMaintenanceTasks();
                alert(`Maintenance cancelled: ${task.title}`);
            }
        }

        // Driver management functions
        function updateDriver(driverName) {
            alert(`Updating ${driverName}...\n\nThis will:\n- Download latest driver\n- Stop GPU services\n- Install new driver\n- Restart GPU services\n\nEstimated time: 10-15 minutes`);
        }

        function rollbackDriver(driverName) {
            if (confirm(`Rollback ${driverName} to previous version?`)) {
                alert(`Rolling back ${driverName}...\n\nThis will restore the previous driver version.`);
            }
        }

        function checkDriverUpdates() {
            alert('Checking for driver updates...\n\nAll drivers are up to date!');
        }

        // Configuration functions
        function saveConfiguration() {
            const config = {
                powerLimit: document.getElementById('powerLimit').value,
                tempThreshold: document.getElementById('tempThreshold').value,
                autoMaintenance: document.getElementById('autoMaintenance').value,
                maintenanceWindow: document.getElementById('maintenanceWindow').value,
                alertEmail: document.getElementById('alertEmail').value,
                backupRetention: document.getElementById('backupRetention').value
            };
            
            alert(`Configuration saved!\n\nPower Limit: ${config.powerLimit}%\nTemperature Threshold: ${config.tempThreshold}°C\nAuto Maintenance: ${config.autoMaintenance}\nMaintenance Window: ${config.maintenanceWindow}\nAlert Email: ${config.alertEmail}\nBackup Retention: ${config.backupRetention} days`);
        }

        function resetConfiguration() {
            if (confirm('Reset all configuration to defaults?')) {
                document.getElementById('powerLimit').value = 100;
                document.getElementById('tempThreshold').value = 85;
                document.getElementById('autoMaintenance').value = 'enabled';
                document.getElementById('maintenanceWindow').value = 'manual';
                document.getElementById('alertEmail').value = 'admin@asoba.co';
                document.getElementById('backupRetention').value = 30;
                alert('Configuration reset to defaults!');
            }
        }

        function loadAnalytics() {
            // Sample analytics data
            const analyticsData = [
                { id: 'GPU-001', type: 'NVIDIA A100', utilization: '92%', costHour: '$3.20', revenueHour: '$12.50', roi: '291%', status: 'Active' },
                { id: 'GPU-002', type: 'NVIDIA A100', utilization: '87%', costHour: '$3.20', revenueHour: '$11.20', roi: '250%', status: 'Active' },
                { id: 'GPU-003', type: 'NVIDIA V100', utilization: '78%', costHour: '$2.10', revenueHour: '$7.80', roi: '271%', status: 'Active' },
                { id: 'GPU-004', type: 'NVIDIA V100', utilization: '95%', costHour: '$2.10', revenueHour: '$9.50', roi: '352%', status: 'Active' },
                { id: 'GPU-005', type: 'NVIDIA RTX 4090', utilization: '83%', costHour: '$1.50', revenueHour: '$6.20', roi: '313%', status: 'Active' },
                { id: 'GPU-006', type: 'NVIDIA RTX 4090', utilization: '89%', costHour: '$1.50', revenueHour: '$6.70', roi: '347%', status: 'Active' },
                { id: 'GPU-007', type: 'NVIDIA A100', utilization: '91%', costHour: '$3.20', revenueHour: '$12.10', roi: '278%', status: 'Active' },
                { id: 'GPU-008', type: 'NVIDIA V100', utilization: '76%', costHour: '$2.10', revenueHour: '$7.60', roi: '262%', status: 'Active' },
                { id: 'GPU-009', type: 'NVIDIA RTX 4090', utilization: '94%', costHour: '$1.50', revenueHour: '$7.10', roi: '373%', status: 'Active' },
                { id: 'GPU-010', type: 'NVIDIA A100', utilization: '88%', costHour: '$3.20', revenueHour: '$11.00', roi: '244%', status: 'Active' }
            ];

            // Populate analytics table
            const tableBody = document.getElementById('analyticsTableBody');
            if (tableBody) {
                tableBody.innerHTML = '';
                analyticsData.forEach(gpu => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${gpu.id}</td>
                        <td>${gpu.type}</td>
                        <td><span class="utilization-badge">${gpu.utilization}</span></td>
                        <td>${gpu.costHour}</td>
                        <td>${gpu.revenueHour}</td>
                        <td><span class="roi-badge">${gpu.roi}</span></td>
                        <td><span class="status-badge status-active">${gpu.status}</span></td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Add event listeners for chart controls
            setupAnalyticsControls();
            
            // Wait for Chart.js to be available
            setTimeout(() => {
                console.log('Attempting to create charts...');
                updateCostChart('30d');
                updateUtilizationChart('7d');
            }, 500);
        }

        function setupAnalyticsControls() {
            // Cost timeframe selector
            const costTimeframe = document.getElementById('costTimeframe');
            if (costTimeframe) {
                costTimeframe.addEventListener('change', function() {
                    updateCostChart(this.value);
                });
            }

            // Utilization timeframe selector
            const utilizationTimeframe = document.getElementById('utilizationTimeframe');
            if (utilizationTimeframe) {
                utilizationTimeframe.addEventListener('change', function() {
                    updateUtilizationChart(this.value);
                });
            }


            // Analytics filter
            const analyticsFilter = document.getElementById('analyticsFilter');
            if (analyticsFilter) {
                analyticsFilter.addEventListener('change', function() {
                    filterAnalyticsTable(this.value);
                });
            }

            // Export button
            const exportBtn = document.querySelector('.export-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function() {
                    exportAnalyticsData();
                });
            }
        }

        let costChartInstance = null;
        let analyticsUtilizationChartInstance = null;

        function updateCostChart(timeframe) {
            const canvas = document.getElementById('costAnalysisChart');
            console.log('Cost chart canvas element:', canvas);
            
            if (!canvas) {
                console.error('Cost chart canvas element not found');
                return;
            }
            
            if (typeof canvas.getContext !== 'function') {
                console.error('Cost chart canvas element is not a proper canvas element');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                return;
            }
            
            console.log('Creating cost chart with timeframe:', timeframe);
            
            // Destroy existing chart if it exists
            if (costChartInstance) {
                costChartInstance.destroy();
            }
            
            let labels, data;
            
            if (timeframe === '7d') {
                labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                data = [420, 460, 390, 440, 475, 410, 445];
            } else if (timeframe === '30d') {
                labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                data = [1680, 1840, 1560, 1760];
            } else if (timeframe === '90d') {
                labels = ['Month 1', 'Month 2', 'Month 3'];
                data = [5040, 5520, 4680];
            }
            
            costChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Cost ($)',
                        data: data,
                        backgroundColor: 'rgba(69, 91, 241, 0.8)',
                        borderColor: '#455BF1',
                        borderWidth: 2,
                        borderRadius: 4,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function updateUtilizationChart(timeframe) {
            const canvas = document.getElementById('gpuUtilizationChart');
            console.log('Canvas element:', canvas);
            
            if (!canvas) {
                console.error('Canvas element not found');
                return;
            }
            
            if (typeof canvas.getContext !== 'function') {
                console.error('Canvas element is not a proper canvas element');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Check if Chart.js is loaded
            if (typeof Chart === 'undefined') {
                console.error('Chart.js not loaded');
                return;
            }
            
            console.log('Creating chart with timeframe:', timeframe);
            
            // Destroy existing chart if it exists
            if (analyticsUtilizationChartInstance) {
                analyticsUtilizationChartInstance.destroy();
            }
            
            let labels, data;
            
            if (timeframe === '24h') {
                labels = ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'];
                data = [85, 78, 92, 88, 95, 82];
            } else if (timeframe === '7d') {
                labels = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
                data = [85, 78, 92, 88, 95, 82, 89];
            } else if (timeframe === '30d') {
                labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                data = [87, 92, 78, 88];
            }
            
            analyticsUtilizationChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'GPU Utilization %',
                        data: data,
                        borderColor: '#455BF1',
                        backgroundColor: 'rgba(69, 91, 241, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#455BF1',
                        pointBorderColor: '#455BF1',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverBackgroundColor: '#455BF1'
                        }
                    }
                }
            });
        }


        function filterAnalyticsTable(filter) {
            const tableBody = document.getElementById('analyticsTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const gpuType = row.cells[1].textContent.toLowerCase();
                if (filter === 'all') {
                    row.style.display = '';
                } else if (filter === 'a100' && gpuType.includes('a100')) {
                    row.style.display = '';
                } else if (filter === 'v100' && gpuType.includes('v100')) {
                    row.style.display = '';
                } else if (filter === 'rtx4090' && gpuType.includes('rtx 4090')) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function exportAnalyticsData() {
            const table = document.querySelector('.analytics-table');
            const rows = Array.from(table.querySelectorAll('tr'));
            
            let csvContent = '';
            rows.forEach(row => {
                const cells = Array.from(row.querySelectorAll('th, td'));
                const rowData = cells.map(cell => `"${cell.textContent.trim()}"`).join(',');
                csvContent += rowData + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gpu-analytics.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // GPU management functions
        function viewGpuDetails(gpuId) {
            const gpu = gpuAssets.find(g => g.id === gpuId);
            if (gpu) {
                alert(`GPU Details:\n\nName: ${gpu.name}\nModel: ${gpu.model}\nLocation: ${gpu.location}\nStatus: ${gpu.status}\nUtilization: ${gpu.utilization}%\nTemperature: ${gpu.temperature}°C\nMemory: ${gpu.memory.used}GB / ${gpu.memory.total}GB\nPower: ${gpu.power}W\nActive Jobs: ${gpu.jobs.length}\nLast Maintenance: ${gpu.lastMaintenance}\nNext Maintenance: ${gpu.nextMaintenance}`);
            }
        }

        function manageGpu(gpuId) {
            const gpu = gpuAssets.find(g => g.id === gpuId);
            if (gpu) {
                alert(`Managing GPU: ${gpu.name}\n\nManagement options:\n- Schedule maintenance\n- Update drivers\n- Configure settings\n- View logs\n\nFull management interface coming soon...`);
            }
        }

        // Solar site management functions
        function viewSiteDetails(siteId) {
            const sites = {
                'cummins-midrand': {
                    name: 'Cummins Midrand',
                    type: 'Commercial',
                    capacity: '821.88 kW',
                    location: 'Corners Bridal Veil Road',
                    currentOutput: '0 kW',
                    efficiency: '0%',
                    inverters: 9,
                    status: 'Active',
                    lastMaintenance: '2024-09-15',
                    nextMaintenance: '2024-12-15'
                },
                'fnb-willowbridge': {
                    name: 'FNB Willowbridge',
                    type: 'Commercial',
                    capacity: '51.98 kW',
                    location: '61 Carl Cronje Drive',
                    currentOutput: '0 kW',
                    efficiency: '0%',
                    inverters: 2,
                    status: 'Active',
                    lastMaintenance: '2024-09-10',
                    nextMaintenance: '2024-12-10'
                }
            };
            
            const site = sites[siteId];
            if (!site) return;
            
            // Get current performance data
            const cachedData = getCachedSiteData(siteId);
            
            // Populate the dashboard site details modal
            document.getElementById('dashboardSiteName').textContent = site.name;
            document.getElementById('dashboardSiteType').textContent = site.type;
            document.getElementById('dashboardLocation').textContent = site.location;
            document.getElementById('dashboardCapacity').textContent = site.capacity;
            document.getElementById('dashboardInverters').textContent = site.inverters;
            document.getElementById('dashboardStatus').textContent = site.status;
            document.getElementById('dashboardLastMaintenance').textContent = site.lastMaintenance;
            document.getElementById('dashboardNextMaintenance').textContent = site.nextMaintenance;
            
            // Add current performance metrics
            if (cachedData) {
                document.getElementById('dashboardCurrentOutput').textContent = cachedData.power + ' kW';
                document.getElementById('dashboardEfficiency').textContent = cachedData.efficiency + '%';
                document.getElementById('dashboardUtilization').textContent = cachedData.utilization + '%';
                document.getElementById('dashboardTemperature').textContent = cachedData.temperature + '°C';
            } else {
                document.getElementById('dashboardCurrentOutput').textContent = '0 kW';
                document.getElementById('dashboardEfficiency').textContent = '0%';
                document.getElementById('dashboardUtilization').textContent = '0%';
                document.getElementById('dashboardTemperature').textContent = '25°C';
            }
            
            // Show the modal
            document.getElementById('dashboardSiteDetailsModal').style.display = 'flex';
        }

        function manageSite(siteId) {
            const sites = {
                'cummins-midrand': 'Cummins Midrand',
                'fnb-willowbridge': 'FNB Willowbridge'
            };
            
            const siteName = sites[siteId];
            if (!siteName) return;
            
            // Set the site name in the management modal
            document.getElementById('managementSiteName').textContent = siteName;
            
            // Reset form fields
            document.getElementById('managementAction').value = '';
            document.getElementById('managementPriority').value = '';
            document.getElementById('managementNotes').value = '';
            
            // Show the modal
            document.getElementById('dashboardSiteManagementModal').style.display = 'flex';
        }

        // Site inventory management functions
        function viewSiteInventoryDetails(siteId) {
            const site = siteAssets.find(s => s.id === siteId);
            if (!site) return;
            
            // Get current performance data
            const cachedData = getCachedSiteData(siteId);
            
            // Populate the modal with site data
            document.getElementById('detailSiteName').textContent = site.name;
            document.getElementById('detailSiteType').textContent = site.type;
            document.getElementById('detailLocation').textContent = site.location;
            document.getElementById('detailCapacity').textContent = site.capacity + ' kW';
            document.getElementById('detailInverterCount').textContent = site.inverterCount;
            document.getElementById('detailPanelCount').textContent = site.panelCount.toLocaleString();
            document.getElementById('detailPanelWattage').textContent = site.panelWattage + 'W';
            document.getElementById('detailInverterBrand').textContent = site.inverterBrand;
            document.getElementById('detailStatus').textContent = site.status.charAt(0).toUpperCase() + site.status.slice(1);
            document.getElementById('detailCommissionDate').textContent = new Date(site.commissionDate).toLocaleDateString();
            document.getElementById('detailNextMaintenance').textContent = 'Dec 15, 2024'; // Static for now
            document.getElementById('detailGridConnection').textContent = site.gridConnection;
            document.getElementById('detailNotes').textContent = site.notes || 'No additional notes';
            
            // Add current performance metrics
            if (cachedData) {
                document.getElementById('detailUtilization').textContent = cachedData.utilization + '%';
                document.getElementById('detailTemperature').textContent = cachedData.temperature + '°C';
                document.getElementById('detailPower').textContent = cachedData.power + ' kW';
                document.getElementById('detailEfficiency').textContent = cachedData.efficiency + '%';
            } else {
                document.getElementById('detailUtilization').textContent = '0%';
                document.getElementById('detailTemperature').textContent = '25°C';
                document.getElementById('detailPower').textContent = '0 kW';
                document.getElementById('detailEfficiency').textContent = '0%';
            }
            
            // Show the modal
            document.getElementById('siteDetailsModal').style.display = 'flex';
        }

        function scheduleSiteMaintenance(siteId) {
            const site = siteAssets.find(s => s.id === siteId);
            if (!site) return;
            
            // Set the site name in the form
            document.getElementById('maintenanceSiteName').value = site.name;
            
            // Set default date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('siteMaintenanceDate').value = tomorrow.toISOString().split('T')[0];
            
            // Reset form
            document.getElementById('siteMaintenanceType').value = '';
            document.getElementById('siteMaintenancePriority').value = '';
            document.getElementById('siteMaintenanceDuration').value = '';
            document.getElementById('siteMaintenanceTechnician').value = '';
            document.getElementById('siteMaintenanceDescription').value = '';
            
            // Show the modal
            document.getElementById('siteMaintenanceModal').style.display = 'flex';
        }

        // Site modal functions
        function openAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'flex';
        }

        function closeAddSiteModal() {
            document.getElementById('addSiteModal').style.display = 'none';
        }
        
        function closeSiteDetailsModal() {
            document.getElementById('siteDetailsModal').style.display = 'none';
        }
        
        function closeSiteMaintenanceModal() {
            document.getElementById('siteMaintenanceModal').style.display = 'none';
            document.getElementById('siteMaintenanceForm').reset();
        }
        
        function editSiteDetails() {
            alert('Edit functionality coming soon! This will allow you to modify site details.');
        }

        function testSiteConnection() {
            const siteName = document.getElementById('siteName').value;
            const siteLocation = document.getElementById('siteLocation').value;
            const gridConnection = document.getElementById('gridConnection').value;
            
            if (!siteName || !siteLocation || !gridConnection) {
                alert('Please fill in Site Name, Address, and Grid Connection before testing.');
                return;
            }
            
            // Simulate connection test
            const testBtn = document.getElementById('testSiteConnectionBtn');
            const originalText = testBtn.textContent;
            testBtn.textContent = '⏳ Testing...';
            testBtn.disabled = true;
            
            setTimeout(() => {
                testBtn.textContent = originalText;
                testBtn.disabled = false;
                
                if (Math.random() > 0.2) { // 80% success rate
                    alert(`Connection test successful!\n\nSite: ${siteName}\nLocation: ${siteLocation}\nGrid Connection: ${gridConnection}\n\nYou can now add this site to inventory.`);
                } else {
                    alert(`Connection test failed!\n\nPlease check:\n- Site address is correct\n- Grid connection details\n- Network connectivity\n- Access permissions\n\nTry again after fixing the connection issues.`);
                }
            }, 2000);
        }

        function startGpu(gpuId) {
            const gpu = gpuAssets.find(g => g.id === gpuId);
            if (gpu) {
                gpu.status = 'active';
                gpu.utilization = 0;
                gpu.temperature = 45;
                gpu.power = 50;
                loadDashboard();
                alert(`GPU "${gpu.name}" started successfully!`);
            }
        }

        function stopGpu(gpuId) {
            const gpu = gpuAssets.find(g => g.id === gpuId);
            if (gpu) {
                gpu.status = 'idle';
                gpu.utilization = 0;
                gpu.temperature = 35;
                gpu.power = 20;
                gpu.jobs = [];
                loadDashboard();
                alert(`GPU "${gpu.name}" stopped successfully!`);
            }
        }

        // Initialize navigation and all event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add click handlers to nav buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    switchSection(sectionId);
                });
            });
            
            // Handle maintenance form submission
            const maintenanceForm = document.getElementById('maintenanceForm');
            if (maintenanceForm) {
                maintenanceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const gpuId = this.getAttribute('data-gpu-id');
                    const gpu = gpuAssets.find(g => g.id === gpuId);
                    
                    const taskData = {
                        id: 'maint-' + Date.now(),
                        title: `${document.getElementById('maintenanceType').value.charAt(0).toUpperCase() + document.getElementById('maintenanceType').value.slice(1)} - ${gpu.name}`,
                        type: document.getElementById('maintenanceType').value.charAt(0).toUpperCase() + document.getElementById('maintenanceType').value.slice(1),
                        scheduledDate: document.getElementById('maintenanceDate').value,
                        estimatedDuration: document.getElementById('maintenanceDuration').value,
                        priority: document.getElementById('maintenancePriority').value.charAt(0).toUpperCase() + document.getElementById('maintenancePriority').value.slice(1),
                        description: document.getElementById('maintenanceDescription').value,
                        technician: document.getElementById('maintenanceTechnician').value
                    };
                    
                    // Add to maintenance tasks
                    maintenanceTasks.push(taskData);
                    
                    // Refresh maintenance display
                    loadMaintenanceTasks();
                    
                    // Close modal and show success
                    closeMaintenanceModal();
                    alert(`Maintenance task created successfully!\n\nTask: ${taskData.title}\nDate: ${new Date(taskData.scheduledDate).toLocaleDateString()}\nTechnician: ${taskData.technician}`);
                });
            }
            
            // Close modal when clicking outside
            const maintenanceModal = document.getElementById('maintenanceModal');
            if (maintenanceModal) {
                maintenanceModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeMaintenanceModal();
                    }
                });
            }
            
            // Handle Add Site form submission
            const addSiteForm = document.getElementById('addSiteForm');
            if (addSiteForm) {
                addSiteForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Check if connection was tested successfully
                    const testBtn = document.getElementById('testSiteConnectionBtn');
                    if (testBtn.textContent !== '✅ Connection Successful') {
                        alert('Please test the connection first before adding the site to inventory.');
                        return;
                    }
                    
                    const siteData = {
                        id: 'site-' + String(siteAssets.length + 1).padStart(3, '0'),
                        name: document.getElementById('siteName').value,
                        type: document.getElementById('siteType').value,
                        location: document.getElementById('siteLocation').value,
                        capacity: parseFloat(document.getElementById('siteCapacity').value),
                        inverterCount: parseInt(document.getElementById('inverterCount').value),
                        commissionDate: document.getElementById('commissionDate').value,
                        panelCount: parseInt(document.getElementById('panelCount').value),
                        panelWattage: parseInt(document.getElementById('panelWattage').value),
                        inverterBrand: document.getElementById('inverterBrand').value,
                        gridConnection: document.getElementById('gridConnection').value,
                        notes: document.getElementById('siteNotes').value,
                        status: 'active',
                        utilization: 0,
                        temperature: 25,
                        power: 0,
                        efficiency: 0
                    };
                    
                    // Add to site assets
                    siteAssets.push(siteData);
                    
                    // Refresh inventory display
                    loadInventoryCards();
                    
                    // Close modal and show success
                    closeAddSiteModal();
                    
                    alert(`Site "${siteData.name}" added to inventory successfully!\n\nStatus: ${siteData.status}\nCapacity: ${siteData.capacity} kW\nLocation: ${siteData.location}\nInverters: ${siteData.inverterCount}`);
                });
            }
            
            // Close Add Site modal when clicking outside
            const addSiteModal = document.getElementById('addSiteModal');
            if (addSiteModal) {
                addSiteModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeAddSiteModal();
                    }
                });
            }
            
            // Close Site Details modal when clicking outside
            const siteDetailsModal = document.getElementById('siteDetailsModal');
            if (siteDetailsModal) {
                siteDetailsModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeSiteDetailsModal();
                    }
                });
            }
            
            // Close Site Maintenance modal when clicking outside
            const siteMaintenanceModal = document.getElementById('siteMaintenanceModal');
            if (siteMaintenanceModal) {
                siteMaintenanceModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeSiteMaintenanceModal();
                    }
                });
            }
            
            // Handle Site Maintenance form submission
            const siteMaintenanceForm = document.getElementById('siteMaintenanceForm');
            if (siteMaintenanceForm) {
                siteMaintenanceForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        siteName: document.getElementById('maintenanceSiteName').value,
                        type: document.getElementById('siteMaintenanceType').value,
                        date: document.getElementById('siteMaintenanceDate').value,
                        priority: document.getElementById('siteMaintenancePriority').value,
                        duration: document.getElementById('siteMaintenanceDuration').value,
                        technician: document.getElementById('siteMaintenanceTechnician').value,
                        description: document.getElementById('siteMaintenanceDescription').value
                    };
                    
                    // Validate required fields
                    if (!formData.type || !formData.date || !formData.priority || !formData.duration || !formData.technician) {
                        alert('Please fill in all required fields.');
                        return;
                    }
                    
                    // Create maintenance task
                    const taskId = 'maint-' + Date.now();
                    const maintenanceTask = {
                        id: taskId,
                        siteName: formData.siteName,
                        type: formData.type.charAt(0).toUpperCase() + formData.type.slice(1),
                        scheduledDate: formData.date,
                        priority: formData.priority.charAt(0).toUpperCase() + formData.priority.slice(1),
                        duration: formData.duration + ' hours',
                        technician: formData.technician,
                        description: formData.description,
                        status: 'Scheduled',
                        createdAt: new Date().toISOString()
                    };
                    
                    // Add to maintenance tasks (you might want to store this in a proper data structure)
                    console.log('New maintenance task created:', maintenanceTask);
                    
                    // Close modal and show success
                    closeSiteMaintenanceModal();
                    alert(`Maintenance task scheduled successfully!\n\nSite: ${formData.siteName}\nType: ${maintenanceTask.type}\nDate: ${new Date(formData.date).toLocaleDateString()}\nTechnician: ${formData.technician}\nDuration: ${formData.duration} hours`);
                });
            }
            
            // Dashboard modal event listeners
            const dashboardSiteDetailsModal = document.getElementById('dashboardSiteDetailsModal');
            if (dashboardSiteDetailsModal) {
                dashboardSiteDetailsModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDashboardSiteDetailsModal();
                    }
                });
            }
            
            const dashboardSiteManagementModal = document.getElementById('dashboardSiteManagementModal');
            if (dashboardSiteManagementModal) {
                dashboardSiteManagementModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeDashboardSiteManagementModal();
                    }
                });
            }
            
            const dashboardManagementForm = document.getElementById('dashboardManagementForm');
            if (dashboardManagementForm) {
                dashboardManagementForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        action: document.getElementById('managementAction').value,
                        priority: document.getElementById('managementPriority').value,
                        notes: document.getElementById('managementNotes').value
                    };
                    
                    // Execute management action (placeholder)
                    console.log('Management action executed:', formData);
                    
                    // Close modal and show success
                    closeDashboardSiteManagementModal();
                    alert(`Management action executed successfully!\n\nAction: ${formData.action}\nPriority: ${formData.priority}\nNotes: ${formData.notes || 'None'}`);
                });
            }
            
            // Site Components modal event listeners
            const siteComponentsModal = document.getElementById('siteComponentsModal');
            if (siteComponentsModal) {
                siteComponentsModal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeSiteComponentsModal();
                    }
                });
            }
            
            // Initialize with dashboard
            switchSection('dashboard');
            
            // Animate metrics on load
            animateMetrics();
        });

        // Animate metrics
        function animateMetrics() {
            const metrics = document.querySelectorAll('.metric-value');
            metrics.forEach(metric => {
                const finalValue = metric.textContent;
                const isNumeric = !isNaN(finalValue.replace(/[^\d.]/g, ''));
                
                if (isNumeric) {
                    const numericValue = parseFloat(finalValue.replace(/[^\d.]/g, ''));
                    let currentValue = 0;
                    const increment = numericValue / 30;
                    const timer = setInterval(() => {
                        currentValue += increment;
                        if (currentValue >= numericValue) {
                            currentValue = numericValue;
                            clearInterval(timer);
                        }
                        metric.textContent = finalValue.replace(/[\d,]+/, Math.round(currentValue).toLocaleString());
                    }, 50);
                }
            });
        }
    </script>
</body>
</html>